# Руководство пользователя DBF Importer

## Обзор

DBF Importer - это приложение для импорта данных из DBF файлов системы 1С в базу данных системы управления строительством.

## Установка

1. Убедитесь, что у вас установлен Python 3.8 или выше.
2. Установите необходимые зависимости:
   ```
   pip install -r requirements.txt
   ```

## Запуск приложения

Для запуска приложения выполните команду:
```
python main.py
```

## Использование

### 1. Выбор DBF файла

1. Нажмите кнопку "Обзор..." для выбора DBF файла.
2. В открывшемся диалоге выберите нужный DBF файл.
3. Путь к выбранному файлу отобразится в поле над кнопкой.

### 2. Настройка импорта

1. В разделе "Настройки импорта" отметьте галочками сущности, которые нужно импортировать:
   - Номенклатура
   - Виды работ
   - Материалы
   - Элементы затрат

2. При необходимости установите флаг "Очистить существующие данные перед импортом", чтобы удалить текущие данные из таблиц перед импортом новых.

### 3. Проверка структуры DBF файла

Перед импортом рекомендуется проверить структуру DBF файла:

1. Нажмите кнопку "Проверить структуру".
2. В открывшемся диалоге будет отображена информация о структуре файла:
   - Статус проверки (корректна/ошибка)
   - Количество записей в файле
   - Детали о missing или лишних полях

3. Если структура файла корректна, можно приступать к импорту.

### 4. Импорт данных

1. Нажмите кнопку "Импорт" для начала процесса импорта.
2. Во время импорта будет отображаться прогресс-бар и лог операций.
3. По завершении импорта будет показано сообщение с результатами.

## Структура DBF файлов

**Важно:** В данном проекте сущность "Номенклатура" импортируется напрямую в таблицу Works. Термин "Номенклатура" используется как синоним для "Видов работ". Оба файла (nomenclature.dbf и works.dbf) импортируются в одну таблицу works.

Приложение ожидает следующую структуру DBF файлов:

### Номенклатура (nomenclature.dbf)
**Важно:** Данные из этого файла импортируются в таблицу works.
- ID - уникальный идентификатор
- NAME - наименование
- PARENT - ID родительской записи
- CODE - код вида работ
- UNIT - единица измерения
- PRICE - цена за единицу
- LABOR_RATE - норма трудозатрат
- DELMARK - признак удаления

### Виды работ (works.dbf)
**Важно:** Данные из этого файла импортируются в ту же таблицу works, что и номенклатура.
- ID - уникальный идентификатор
- NAME - наименование
- PARENT - ID родительской записи
- CODE - код вида работ
- UNIT - единица измерения
- PRICE - цена за единицу
- LABOR_RATE - норма трудозатрат
- DELMARK - признак удаления

### Материалы (materials.dbf)
- ID - уникальный идентификатор
- NAME - наименование
- UNIT - ID единицы измерения
- DELMARK - признак удаления

### Элементы затрат (cost_items.dbf)
- ID - уникальный идентификатор
- NAME - наименование
- WORK - ID вида работы
- COST - стоимость
- DELMARK - признак удаления

## Возможные проблемы и решения

### Ошибка "DBF файл не найден"
- Убедитесь, что путь к файлу указан верно.
- Проверьте, что файл имеет расширение .dbf.

### Ошибка "Отсутствуют обязательные поля"
- Проверьте структуру DBF файла на соответствие ожидаемой.
- Убедитесь, что все обязательные поля присутствуют в файле.

### Ошибка при импорте данных
- Проверьте, что база данных доступна и не заблокирована другим процессом.
- Убедитесь, что у вас есть права на запись в базу данных.

### Проблемы с кодировкой
- По умолчанию используется кодировка cp866 для DBF файлов 1С.
- Если у вас другая кодировка, измените настройку DBF_ENCODING в файле config/settings.py.

## Логирование

Все операции приложения записываются в файл dbf_importer.log, который создается в той же директории, что и приложение. В логе содержится информация о:

- Запуске приложения
- Выбранных файлах
- Процессе импорта
- Ошибках и предупреждениях

## Техническая поддержка

При возникновении проблем, не описанных в данном руководстве, обратитесь к разработчику, предоставив:

- Версию приложения
- Версию Python
- Содержимое файла dbf_importer.log
- Описание проблемы и шаги её воспроизведения