import{d as w,h as C,c as D,w as s,a as n,b as S,j as E,k as N,i as m,n as $,t as i,e as l,u as c,l as B,o as p}from"./index-C7yHV0zj.js";import{u as V,_ as F}from"./DataTable.vue_vue_type_script_setup_true_lang-BlFTPoEo.js";import{getEstimates as P,deleteEstimate as R}from"./documents-aFSYETPL.js";import{_ as j}from"./AppLayout.vue_vue_type_script_setup_true_lang-BRkCAdoF.js";const M={class:"space-y-6"},L=["onClick"],T=["onClick"],A=w({__name:"EstimateListView",setup(U){const u=B(),t=V(),f=[{key:"number",label:"Номер"},{key:"date",label:"Дата"},{key:"customer_name",label:"Заказчик"},{key:"object_name",label:"Объект"},{key:"total_sum",label:"Сумма"},{key:"is_posted",label:"Статус"}];function g(e){return new Date(e).toLocaleDateString("ru-RU")}function b(e){return new Intl.NumberFormat("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}async function r(){t.loading.value=!0;try{const e=await P(t.queryParams.value);t.data.value=e.data,t.pagination.value=e.pagination}catch(e){console.error("Failed to load estimates:",e)}finally{t.loading.value=!1}}function h(e){t.setPage(e),r()}function x(e){t.setSearch(e),r()}function _(e,o){t.setSort(e,o),r()}function k(){u.push("/documents/estimates/new")}function d(e){u.push(`/documents/estimates/${e.id}`)}async function y(e){if(confirm(`Удалить смету "${e.number}"?`))try{await R(e.id),await r()}catch(o){alert(o.response?.data?.detail||"Ошибка при удалении")}}return C(()=>{r()}),(e,o)=>(p(),D(j,null,{default:s(()=>[n("div",M,[o[1]||(o[1]=n("div",null,[n("h2",{class:"text-2xl font-bold text-gray-900"},"Сметы"),n("p",{class:"mt-1 text-sm text-gray-600"},"Управление сметами")],-1)),S(F,{columns:f,data:c(t).data.value,loading:c(t).loading.value,pagination:c(t).pagination.value,onRowClick:d,onPageChange:h,onSearch:x,onSort:_},{"header-actions":s(()=>[n("button",{onClick:k,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700"},[...o[0]||(o[0]=[n("svg",{class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),l(" Создать смету ",-1)])])]),"cell-date":s(({value:a})=>[l(i(g(a)),1)]),"cell-total_sum":s(({value:a})=>[l(i(b(a)),1)]),"cell-is_posted":s(({value:a})=>[n("span",{class:$(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",a?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},i(a?"Проведен":"Не проведен"),3)]),actions:s(({row:a})=>[n("button",{onClick:m(v=>d(a),["stop"]),class:"text-blue-600 hover:text-blue-900 mr-4"}," Открыть ",8,L),a.is_posted?N("",!0):(p(),E("button",{key:0,onClick:m(v=>y(a),["stop"]),class:"text-red-600 hover:text-red-900"}," Удалить ",8,T))]),_:1},8,["data","loading","pagination"])])]),_:1}))}});export{A as default};
