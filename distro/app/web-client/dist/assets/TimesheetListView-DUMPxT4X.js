import{d as w,h as C,c as S,w as s,a as o,b as D,j as $,k as B,i as h,n as T,t as l,e as i,u as c,l as V,o as p}from"./index-C7yHV0zj.js";import{u as E,_ as M}from"./DataTable.vue_vue_type_script_setup_true_lang-BlFTPoEo.js";import{getTimesheets as N,deleteTimesheet as P}from"./documents-aFSYETPL.js";import{_ as R}from"./AppLayout.vue_vue_type_script_setup_true_lang-BRkCAdoF.js";const j={class:"space-y-6"},L=["onClick"],I=["onClick"],Y=w({__name:"TimesheetListView",setup(U){const d=V(),a=E(),f=[{key:"number",label:"Номер"},{key:"date",label:"Дата"},{key:"month_year",label:"Период"},{key:"object_name",label:"Объект"},{key:"estimate_number",label:"Смета"},{key:"foreman_name",label:"Бригадир"},{key:"is_posted",label:"Статус"}];function g(e){return new Date(e).toLocaleDateString("ru-RU")}function b(e){const[n,t]=e.split("-");return new Date(parseInt(n),parseInt(t)-1).toLocaleDateString("ru-RU",{year:"numeric",month:"long"})}async function r(){a.loading.value=!0;try{const e=await N(a.queryParams.value);a.data.value=e.data,a.pagination.value=e.pagination}catch(e){console.error("Failed to load timesheets:",e)}finally{a.loading.value=!1}}function _(e){a.setPage(e),r()}function y(e){a.setSearch(e),r()}function x(e,n){a.setSort(e,n),r()}function k(){d.push("/documents/timesheets/new")}function u(e){d.push(`/documents/timesheets/${e.id}`)}async function v(e){if(confirm(`Удалить табель ${e.number}?`))try{await P(e.id),await r()}catch(n){alert(n.response?.data?.detail||"Ошибка при удалении")}}return C(()=>{r()}),(e,n)=>(p(),S(R,null,{default:s(()=>[o("div",j,[n[1]||(n[1]=o("div",null,[o("h2",{class:"text-2xl font-bold text-gray-900"},"Табели"),o("p",{class:"mt-1 text-sm text-gray-600"},"Управление табелями учета рабочего времени")],-1)),D(M,{columns:f,data:c(a).data.value,loading:c(a).loading.value,pagination:c(a).pagination.value,onRowClick:u,onPageChange:_,onSearch:y,onSort:x},{"header-actions":s(()=>[o("button",{onClick:k,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700"},[...n[0]||(n[0]=[o("svg",{class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),i(" Создать табель ",-1)])])]),"cell-date":s(({value:t})=>[i(l(g(t)),1)]),"cell-month_year":s(({value:t})=>[i(l(b(t)),1)]),"cell-is_posted":s(({value:t})=>[o("span",{class:T(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",t?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},l(t?"Проведен":"Не проведен"),3)]),actions:s(({row:t})=>[o("button",{onClick:h(m=>u(t),["stop"]),class:"text-blue-600 hover:text-blue-900 mr-4"}," Открыть ",8,L),t.is_posted?B("",!0):(p(),$("button",{key:0,onClick:h(m=>v(t),["stop"]),class:"text-red-600 hover:text-red-900"}," Удалить ",8,I))]),_:1},8,["data","loading","pagination"])])]),_:1}))}});export{Y as default};
