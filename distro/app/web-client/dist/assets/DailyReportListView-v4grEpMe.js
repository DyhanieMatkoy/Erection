import{d as v,h as C,c as w,w as s,a as o,b as D,j as S,k as R,i as u,n as $,t as p,e as m,u as l,l as B,o as f}from"./index-C7yHV0zj.js";import{u as V,_ as E}from"./DataTable.vue_vue_type_script_setup_true_lang-BlFTPoEo.js";import{getDailyReports as N,deleteDailyReport as P}from"./documents-aFSYETPL.js";import{_ as M}from"./AppLayout.vue_vue_type_script_setup_true_lang-BRkCAdoF.js";const j={class:"space-y-6"},L=["onClick"],T=["onClick"],A=v({__name:"DailyReportListView",setup(q){const i=B(),t=V(),g=[{key:"date",label:"Дата"},{key:"estimate_number",label:"Смета"},{key:"foreman_name",label:"Бригадир"},{key:"is_posted",label:"Статус"}];function d(e){return new Date(e).toLocaleDateString("ru-RU")}async function r(){t.loading.value=!0;try{const e=await N(t.queryParams.value);t.data.value=e.data,t.pagination.value=e.pagination}catch(e){console.error("Failed to load daily reports:",e)}finally{t.loading.value=!1}}function h(e){t.setPage(e),r()}function x(e){t.setSearch(e),r()}function y(e,n){t.setSort(e,n),r()}function b(){i.push("/documents/daily-reports/new")}function c(e){i.push(`/documents/daily-reports/${e.id}`)}async function _(e){if(confirm(`Удалить отчет от ${d(e.date)}?`))try{await P(e.id),await r()}catch(n){alert(n.response?.data?.detail||"Ошибка при удалении")}}return C(()=>{r()}),(e,n)=>(f(),w(M,null,{default:s(()=>[o("div",j,[n[1]||(n[1]=o("div",null,[o("h2",{class:"text-2xl font-bold text-gray-900"},"Ежедневные отчеты"),o("p",{class:"mt-1 text-sm text-gray-600"},"Управление ежедневными отчетами")],-1)),D(E,{columns:g,data:l(t).data.value,loading:l(t).loading.value,pagination:l(t).pagination.value,onRowClick:c,onPageChange:h,onSearch:x,onSort:y},{"header-actions":s(()=>[o("button",{onClick:b,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700"},[...n[0]||(n[0]=[o("svg",{class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),m(" Создать отчет ",-1)])])]),"cell-date":s(({value:a})=>[m(p(d(a)),1)]),"cell-is_posted":s(({value:a})=>[o("span",{class:$(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",a?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},p(a?"Проведен":"Не проведен"),3)]),actions:s(({row:a})=>[o("button",{onClick:u(k=>c(a),["stop"]),class:"text-blue-600 hover:text-blue-900 mr-4"}," Открыть ",8,L),a.is_posted?R("",!0):(f(),S("button",{key:0,onClick:u(k=>_(a),["stop"]),class:"text-red-600 hover:text-red-900"}," Удалить ",8,T))]),_:1},8,["data","loading","pagination"])])]),_:1}))}});export{A as default};
