# Система управления рабочим временем - PyQt6

## Выполненные задачи

### 1. Архивирование C++ версии
- Все C++ файлы (*.cpp, *.h) заархивированы в `cpp_version_archive.zip`
- Удалены все C++ файлы из проекта
- Удалены файлы сборки C++ (CMakeLists.txt, build_msvc.bat, build_qmake.bat, *.pro)
- Проект теперь содержит только PyQt6 версию

### 2. Разработка форм справочников
Все формы справочников полностью реализованы и добавлены в меню:

#### Справочник "Объекты" (Objects)
- Форма редактирования: `src/views/object_form.py`
- Список: `src/views/object_list_form.py`
- Поля: Наименование, Владелец (FK Counterparty), Адрес
- Функции: создание, редактирование, пометка на удаление, поиск

#### Справочник "Организации" (Organizations)
- Форма редактирования: `src/views/organization_form.py`
- Список: `src/views/organization_list_form.py`
- Поля: Наименование, ИНН, Ответственный по умолчанию (FK Person)
- Функции: создание, редактирование, пометка на удаление, поиск

#### Справочник "Физические лица" (Persons)
- Форма редактирования: `src/views/person_form.py`
- Список: `src/views/person_list_form.py`
- Поля: ФИО, Должность, Телефон
- Функции: создание, редактирование, пометка на удаление, поиск

#### Справочник "Виды работ" (Works)
- Форма редактирования: `src/views/work_form.py`
- Список: `src/views/work_list_form.py`
- Поля: Наименование, Единица измерения, Цена, Норма трудозатрат
- Функции: создание, редактирование, пометка на удаление, поиск

#### Справочник "Контрагенты" (Counterparties)
- Форма редактирования: `src/views/counterparty_form.py`
- Список: `src/views/counterparty_list_form.py`
- Поля: Наименование, ИНН, Контактное лицо, Телефон
- Функции: создание, редактирование, пометка на удаление, поиск

### 3. Исправление ошибок открытия форм документов
- Исправлен `BaseDocumentForm.keyPressEvent()` для корректной обработки горячих клавиш
- Формы документов теперь правильно обрабатывают:
  - Ctrl+S - сохранение
  - Ctrl+Shift+S - сохранение и закрытие
  - Esc - закрытие
  - Ctrl+P - печать
- Формы корректно открываются из списков документов

### 4. Исправление автологина
- Упрощен код чтения `env.ini`
- Убраны отладочные print-сообщения
- Автологин теперь работает корректно при наличии файла `env.ini` с полями:
  ```ini
  login=admin
  password=admin
  ```
- При отсутствии файла или ошибке чтения пользователь может войти вручную

## Структура проекта

```
src/
├── data/
│   ├── models/          # Модели данных (только .py)
│   ├── repositories/    # Репозитории (только .py)
│   └── database_manager.py
├── services/            # Сервисы (только .py)
├── viewmodels/          # View Models (только .py)
└── views/               # Формы UI (только .py)
    ├── main_window.py
    ├── login_form.py
    ├── base_document_form.py
    ├── base_list_form.py
    ├── reference_picker_dialog.py
    ├── Справочники:
    │   ├── object_form.py / object_list_form.py
    │   ├── organization_form.py / organization_list_form.py
    │   ├── person_form.py / person_list_form.py
    │   ├── work_form.py / work_list_form.py
    │   └── counterparty_form.py / counterparty_list_form.py
    └── Документы:
        ├── estimate_document_form.py / estimate_list_form.py
        └── daily_report_document_form.py / daily_report_list_form.py
```

## Меню приложения

### Справочники
- Объекты
- Организации
- Физические лица
- Виды работ
- Контрагенты

### Документы
- Сметы
- Ежедневные отчеты

## Горячие клавиши

### Списки
- Insert / F9 - создать новый элемент
- Enter - открыть выбранный элемент
- Delete - пометить на удаление
- Ctrl+F - поиск

### Формы редактирования
- Ctrl+S - сохранить
- Ctrl+Shift+S - сохранить и закрыть
- Esc - закрыть

### Формы документов
- Ctrl+S - сохранить
- Ctrl+Shift+S - сохранить и закрыть
- Ctrl+P - печать
- Esc - закрыть
- Insert - добавить строку (в таблице)
- Delete - удалить строку (в таблице)
- F4 - выбор из справочника (в таблице)

## Запуск приложения

```bash
# Установка зависимостей
pip install -r requirements.txt

# Запуск
python main.py
```

## Автологин

Создайте файл `env.ini` в корне проекта:
```ini
login=admin
password=admin
```

При запуске приложение автоматически войдет с указанными учетными данными.

## Особенности реализации

1. **MDI интерфейс** - все формы открываются в едином окне приложения
2. **Проверка контроля ссылочной целостности** - при удалении справочника проверяется его использование в документах
3. **Автоматический пересчет** - в формах документов автоматически пересчитываются суммы и отклонения
4. **Поиск в реальном времени** - поиск в списках работает по мере ввода текста
5. **Валидация данных** - обязательные поля проверяются при сохранении

## Следующие шаги

- Реализация печатных форм для документов
- Добавление отчетов и аналитики
- Расширение функционала импорта/экспорта
