# Требования к формам списков справочников и документов

## 1. Общие положения

### 1.1 Назначение документа
Настоящий документ определяет требования к разработке форм списков для справочников и документов системы управления строительством. Формы должны обеспечивать удобный просмотр, поиск, фильтрацию и массовые операции с данными.

### 1.2 Область применения
Требования применяются ко всем формам списков:
- Справочники (контрагенты, объекты строительства, работники, виды работ и т.д.)
- Документы (сметы, табели учета рабочего времени, акты выполненных работ и т.д.)

### 1.3 Термины и определения
- **Форма списка** - интерфейс для отображения табличных данных с возможностью навигации и операций
- **Динамический список** - список с автоматической загрузкой данных из базы
- **Отбор** - фильтрация данных по заданным критериям
- **Групповая операция** - действие, применяемое к нескольким выбранным элементам

---

## 2. Структура формы списка

### 2.1 Обязательные элементы интерфейса

#### 2.1.1 Панель команд (верхняя)
Расположение: верхняя часть формы

**Обязательные кнопки:**
- **Создать** - создание нового элемента
- **Изменить** - открытие формы редактирования выбранного элемента
- **Удалить** - удаление выбранного элемента (с подтверждением)
- **Обновить** - перезагрузка данных из базы

**Дополнительные кнопки (по необходимости):**
- **Копировать** - создание копии элемента
- **Провести** - проведение документа (только для документов)
- **Отменить проведение** - отмена проведения документа
- **Печать** - формирование печатных форм
- **Выгрузить** - экспорт данных (Excel, CSV)

#### 2.1.2 Панель отборов и поиска
Расположение: под панелью команд

**Элементы:**
- **Строка быстрого поиска** - поиск по основным полям (наименование, код, номер)
- **Кнопка "Показать отборы"** - раскрытие панели расширенных фильтров
- **Панель расширенных отборов** - набор полей для детальной фильтрации
- **Кнопка "Очистить отборы"** - сброс всех установленных фильтров

#### 2.1.3 Табличная часть (основная область)
Расположение: центральная часть формы

**Требования:**
- Отображение данных в виде таблицы с колонками
- Возможность сортировки по любой колонке (клик на заголовок)
- Выделение текущей строки
- Поддержка множественного выбора (Ctrl+Click, Shift+Click)
- Двойной клик на строке - открытие формы элемента
- Контекстное меню (правая кнопка мыши)

#### 2.1.4 Панель массовых операций
Расположение: над таблицей (появляется при выборе нескольких элементов)

**Элементы:**
- Индикатор количества выбранных элементов
- Кнопка "Выбрать все"
- Кнопка "Снять выделение"
- Кнопки массовых операций (удалить, провести, изменить и т.д.)

#### 2.1.5 Панель навигации и статистики (нижняя)
Расположение: нижняя часть формы

**Элементы:**
- Пагинация (переключение страниц)
- Выбор количества элементов на странице (10, 25, 50, 100, Все)
- Общее количество записей
- Информация о текущей странице

---

## 3. Требования к колонкам таблицы

### 3.1 Обязательные колонки для справочников

| Колонка | Ширина | Сортировка | Описание |
|---------|--------|------------|----------|
| Код | 80-100px | Да | Уникальный код элемента |
| Наименование | 250-400px | Да | Основное наименование |
| Пометка удаления | 40px | Да | Иконка/чекбокс |

### 3.2 Обязательные колонки для документов

| Колонка | Ширина | Сортировка | Описание |
|---------|--------|------------|----------|
| Номер | 100-120px | Да | Номер документа |
| Дата | 100-120px | Да | Дата документа |
| Проведен | 40px | Да | Иконка статуса проведения |
| Контрагент/Объект | 200-300px | Да | Основной реквизит |
| Сумма | 120-150px | Да | Итоговая сумма (если применимо) |
| Автор | 150px | Да | Пользователь, создавший документ |
| Пометка удаления | 40px | Да | Иконка/чекбокс |

### 3.3 Настройка колонок

**Пользователь должен иметь возможность:**
- Изменять ширину колонок (перетаскивание границы)
- Изменять порядок колонок (drag-and-drop заголовков)
- Скрывать/показывать колонки (контекстное меню заголовка)
- Сохранять настройки колонок для текущего пользователя
- Сбрасывать настройки к значениям по умолчанию

---

## 4. Функциональные требования

### 4.1 Поиск и фильтрация

#### 4.1.1 Быстрый поиск
- Поиск выполняется по мере ввода (debounce 300ms)
- Поиск по полям: наименование, код, номер, описание
- Регистронезависимый поиск
- Подсветка найденных совпадений в таблице

#### 4.1.2 Расширенные отборы

**Для справочников:**
- Отбор по коду (точное совпадение, содержит, начинается с)
- Отбор по наименованию (содержит, начинается с)
- Отбор по пометке удаления (показать все / только действующие / только удаленные)
- Отбор по дополнительным реквизитам (специфичные для каждого справочника)

**Для документов:**
- Отбор по периоду (дата с, дата по)
- Быстрые периоды (сегодня, вчера, текущая неделя, текущий месяц, текущий год)
- Отбор по статусу проведения (все / проведенные / не проведенные)
- Отбор по контрагенту/объекту (выбор из справочника)
- Отбор по автору документа
- Отбор по пометке удаления

#### 4.1.3 Сохранение отборов
- Возможность сохранить набор отборов как "Избранный отбор"
- Быстрое применение сохраненных отборов
- Управление списком сохраненных отборов

### 4.2 Сортировка

**Требования:**
- Клик на заголовок колонки - сортировка по возрастанию
- Повторный клик - сортировка по убыванию
- Третий клик - отмена сортировки
- Визуальная индикация направления сортировки (стрелка вверх/вниз)
- Возможность многоуровневой сортировки (Shift+Click)

### 4.3 Массовые операции

#### 4.3.1 Выбор элементов
- Чекбокс в первой колонке каждой строки
- Чекбокс в заголовке таблицы - выбор всех на текущей странице
- Кнопка "Выбрать все" - выбор всех элементов (с учетом отборов)
- Выбор диапазона (Shift+Click)
- Добавление к выбору (Ctrl+Click)

#### 4.3.2 Доступные массовые операции

**Для справочников:**
- Массовое удаление (с подтверждением)
- Массовая установка/снятие пометки удаления
- Массовое изменение реквизитов (открытие формы группового изменения)
- Массовая выгрузка в Excel/CSV

**Для документов:**
- Массовое проведение документов
- Массовая отмена проведения
- Массовое удаление (с подтверждением)
- Массовая установка/снятие пометки удаления
- Массовая печать
- Массовая выгрузка в Excel/CSV

### 4.4 Навигация и производительность

#### 4.4.1 Пагинация
- Серверная пагинация (загрузка только текущей страницы)
- Размер страницы по умолчанию: 25 элементов
- Доступные размеры: 10, 25, 50, 100, Все
- Навигация: Первая, Предыдущая, Следующая, Последняя
- Прямой переход на страницу (ввод номера)

#### 4.4.2 Оптимизация загрузки
- Lazy loading при прокрутке (опционально)
- Кэширование загруженных данных
- Индикатор загрузки при обновлении данных
- Отмена предыдущего запроса при новом поиске/фильтрации

---

## 5. Требования к интерфейсу

### 5.1 Визуальное оформление

#### 5.1.1 Цветовая схема
- Заголовок таблицы: светло-серый фон (#F5F5F5)
- Четные строки: белый фон (#FFFFFF)
- Нечетные строки: очень светло-серый (#FAFAFA)
- Выделенная строка: светло-голубой (#E3F2FD)
- Выбранные строки: голубой (#BBDEFB)
- Строка при наведении: светло-серый (#F0F0F0)

#### 5.1.2 Иконки и индикаторы
- Проведенный документ: зеленая галочка ✓
- Не проведенный документ: серый кружок ○
- Пометка удаления: красный крестик ✗
- Сортировка по возрастанию: стрелка вверх ↑
- Сортировка по убыванию: стрелка вниз ↓
- Загрузка: анимированный спиннер

#### 5.1.3 Типографика
- Заголовки колонок: жирный шрифт, 13px
- Данные таблицы: обычный шрифт, 13px
- Шрифт: системный (Arial, Segoe UI, Roboto)

### 5.2 Адаптивность

**Требования к отзывчивости:**
- Минимальная ширина формы: 800px
- При ширине < 1200px: скрытие второстепенных колонок
- При ширине < 1000px: компактный режим кнопок (только иконки)
- Горизонтальная прокрутка при необходимости
- Фиксированный заголовок таблицы при вертикальной прокрутке

### 5.3 Доступность (Accessibility)

**Требования:**
- Поддержка навигации с клавиатуры (Tab, Enter, Space, стрелки)
- ARIA-атрибуты для скринридеров
- Контрастность текста не менее 4.5:1
- Размер кликабельных элементов не менее 40x40px
- Подсказки (tooltips) для иконок

---

## 6. Поведение формы

### 6.1 Открытие формы списка

**При открытии формы:**
1. Загрузка первой страницы данных (25 элементов)
2. Применение сохраненных пользовательских настроек (колонки, отборы)
3. Для документов: отбор по умолчанию "Текущий месяц"
4. Фокус на строке быстрого поиска

### 6.2 Обновление данных

**Автоматическое обновление:**
- После создания нового элемента
- После изменения элемента
- После удаления элемента
- После проведения/отмены проведения документа

**Ручное обновление:**
- Кнопка "Обновить"
- Горячая клавиша F5

### 6.3 Контекстное меню

**Пункты меню (правая кнопка мыши на строке):**
- Открыть
- Изменить
- Копировать (если применимо)
- Удалить
- ---
- Провести / Отменить проведение (для документов)
- ---
- Установить пометку удаления
- Снять пометку удаления
- ---
- Печать (для документов)

### 6.4 Горячие клавиши

| Клавиша | Действие |
|---------|----------|
| Insert | Создать новый элемент |
| Enter | Открыть выбранный элемент |
| F2 | Изменить выбранный элемент |
| Delete | Удалить выбранный элемент |
| F5 | Обновить список |
| Ctrl+F | Фокус на строке поиска |
| Ctrl+A | Выбрать все элементы |
| Ctrl+C | Копировать выбранный элемент |
| Ctrl+P | Печать (для документов) |
| Esc | Снять выделение / Закрыть панель отборов |

---

## 7. Специфические требования

### 7.1 Формы списков справочников

#### 7.1.1 Справочник "Контрагенты"

**Колонки:**
- Код (100px)
- Наименование (300px)
- ИНН (120px)
- Телефон (150px)
- Email (200px)
- Тип (100px) - Заказчик/Подрядчик/Поставщик
- Пометка удаления (40px)

**Отборы:**
- По типу контрагента
- По наличию ИНН
- По городу

#### 7.1.2 Справочник "Объекты строительства"

**Колонки:**
- Код (100px)
- Наименование (350px)
- Адрес (250px)
- Заказчик (200px)
- Статус (120px) - Планируется/В работе/Завершен
- Дата начала (100px)
- Дата окончания (100px)
- Пометка удаления (40px)

**Отборы:**
- По статусу объекта
- По заказчику
- По периоду (дата начала/окончания)
- По городу

#### 7.1.3 Справочник "Работники"

**Колонки:**
- Табельный номер (100px)
- ФИО (250px)
- Должность (150px)
- Специальность (150px)
- Телефон (150px)
- Дата приема (100px)
- Статус (100px) - Работает/Уволен
- Пометка удаления (40px)

**Отборы:**
- По должности
- По специальности
- По статусу (работает/уволен)
- По дате приема

#### 7.1.4 Справочник "Виды работ"

**Колонки:**
- Код (100px)
- Наименование (400px)
- Единица измерения (100px)
- Категория (150px)
- Нормативная стоимость (120px)
- Пометка удаления (40px)

**Отборы:**
- По категории работ
- По единице измерения
- По диапазону стоимости

### 7.2 Формы списков документов

#### 7.2.1 Документ "Смета"

**Колонки:**
- Номер (100px)
- Дата (100px)
- Проведен (40px)
- Объект строительства (250px)
- Контрагент (200px)
- Сумма (120px)
- Статус (120px) - Черновик/Согласована/Утверждена
- Автор (150px)
- Пометка удаления (40px)

**Отборы:**
- По периоду (дата с, дата по)
- По объекту строительства
- По контрагенту
- По статусу сметы
- По статусу проведения
- По автору
- По диапазону суммы

**Дополнительные кнопки:**
- Согласовать
- Утвердить
- Отклонить
- Печать сметы

#### 7.2.2 Документ "Табель учета рабочего времени"

**Колонки:**
- Номер (100px)
- Дата (100px)
- Проведен (40px)
- Объект строительства (250px)
- Период (150px) - с даты по дату
- Количество работников (100px)
- Всего часов (100px)
- Автор (150px)
- Пометка удаления (40px)

**Отборы:**
- По периоду документа
- По периоду учета (табельный период)
- По объекту строительства
- По работнику (если указан в табличной части)
- По статусу проведения
- По автору

**Дополнительные кнопки:**
- Заполнить по графику
- Печать табеля (форма Т-13)

#### 7.2.3 Документ "Акт выполненных работ"

**Колонки:**
- Номер (100px)
- Дата (100px)
- Проведен (40px)
- Объект строительства (250px)
- Контрагент (200px)
- Сумма (120px)
- Статус (120px) - Черновик/Подписан/Оплачен
- Автор (150px)
- Пометка удаления (40px)

**Отборы:**
- По периоду (дата с, дата по)
- По объекту строительства
- По контрагенту
- По статусу акта
- По статусу проведения
- По автору
- По диапазону суммы
- По наличию оплаты

**Дополнительные кнопки:**
- Подписать
- Создать счет на оплату
- Печать акта (форма КС-2)
- Печать справки (форма КС-3)

---

## 8. Технические требования

### 8.1 Производительность

**Требования к скорости:**
- Время загрузки первой страницы: не более 1 секунды
- Время отклика на поиск/фильтрацию: не более 500ms
- Время сортировки: не более 300ms
- Плавная прокрутка (60 FPS)

**Оптимизация:**
- Использование индексов БД для всех полей поиска и сортировки
- Серверная пагинация и фильтрация
- Кэширование справочных данных
- Виртуализация списка при большом количестве элементов

### 8.2 Безопасность

**Требования:**
- Проверка прав доступа на уровне API
- Права на просмотр списка
- Права на создание элементов
- Права на изменение элементов
- Права на удаление элементов
- Права на проведение документов (для документов)
- Права на массовые операции

**Видимость кнопок:**
- Кнопки недоступных операций должны быть скрыты или неактивны
- Подсказка при наведении на неактивную кнопку: "Недостаточно прав"

### 8.3 Логирование

**События для логирования:**
- Открытие формы списка
- Применение отборов
- Выполнение массовых операций
- Удаление элементов
- Проведение/отмена проведения документов
- Экспорт данных

---

## 9. Требования к тестированию

### 9.1 Функциональное тестирование

**Тест-кейсы:**
1. Открытие формы списка
2. Создание нового элемента
3. Изменение существующего элемента
4. Удаление элемента (с подтверждением)
5. Быстрый поиск по различным полям
6. Применение расширенных отборов
7. Сортировка по каждой колонке
8. Изменение размера страницы
9. Навигация по страницам
10. Выбор нескольких элементов
11. Массовые операции
12. Сохранение настроек колонок
13. Экспорт данных
14. Работа горячих клавиш
15. Контекстное меню

### 9.2 Тестирование производительности

**Сценарии:**
- Загрузка списка с 10, 100, 1000, 10000 элементов
- Поиск в больших списках
- Сортировка больших списков
- Массовые операции с большим количеством элементов

### 9.3 Тестирование совместимости

**Браузеры:**
- Chrome (последние 2 версии)
- Firefox (последние 2 версии)
- Edge (последние 2 версии)
- Safari (последние 2 версии)

**Разрешения экрана:**
- 1920x1080 (Full HD)
- 1366x768 (HD)
- 1280x1024 (SXGA)

---

## 10. Приемка работы

### 10.1 Критерии приемки

**Форма списка считается готовой, если:**
1. Реализованы все обязательные элементы интерфейса
2. Работают все функции поиска, фильтрации и сортировки
3. Реализованы все массовые операции
4. Настройки колонок сохраняются для пользователя
5. Форма работает во всех поддерживаемых браузерах
6. Производительность соответствует требованиям
7. Пройдены все тест-кейсы
8. Документация обновлена

### 10.2 Документация

**Обязательные документы:**
- Руководство пользователя (описание работы с формой)
- Техническая документация (API, структура данных)
- Описание прав доступа
- Список горячих клавиш

---

## 11. Приложения

### 11.1 Примеры макетов

*(Здесь должны быть скриншоты или макеты форм)*

### 11.2 Примеры SQL-запросов

```sql
-- Получение списка контрагентов с пагинацией
SELECT 
    id,
    code,
    name,
    inn,
    phone,
    email,
    type,
    is_deleted
FROM counterparties
WHERE 
    is_deleted = 0
    AND (name LIKE '%поиск%' OR code LIKE '%поиск%')
ORDER BY name
LIMIT 25 OFFSET 0;

-- Получение списка документов "Смета" с отборами
SELECT 
    e.id,
    e.number,
    e.date,
    e.is_posted,
    e.status,
    e.total_amount,
    c.name as counterparty_name,
    o.name as object_name,
    u.username as author
FROM estimates e
LEFT JOIN counterparties c ON e.counterparty_id = c.id
LEFT JOIN construction_objects o ON e.object_id = o.id
LEFT JOIN users u ON e.created_by = u.id
WHERE 
    e.is_deleted = 0
    AND e.date BETWEEN '2024-01-01' AND '2024-12-31'
    AND (e.object_id = 123 OR 123 IS NULL)
    AND (e.is_posted = 1 OR 1 IS NULL)
ORDER BY e.date DESC, e.number DESC
LIMIT 25 OFFSET 0;
```

### 11.3 Примеры API endpoints

```
GET /api/references/counterparties
GET /api/references/construction-objects
GET /api/references/workers
GET /api/references/work-types

GET /api/documents/estimates
GET /api/documents/timesheets
GET /api/documents/work-acts

POST /api/documents/estimates/bulk-post
POST /api/documents/estimates/bulk-unpost
DELETE /api/documents/estimates/bulk-delete
```

---

## Версия документа

- **Версия:** 1.0
- **Дата:** 30.11.2024
- **Автор:** Отдел разработки
- **Статус:** Утвержден

---

## История изменений

| Дата | Версия | Автор | Описание изменений |
|------|--------|-------|-------------------|
| 30.11.2024 | 1.0 | Отдел разработки | Первая версия документа |
