# Исправление проблемы аутентификации

## Проблема
При попытке создать смету возникала ошибка 401 Unauthorized.

## Причина
1. В JWT токене поле `sub` (subject) было числом, а стандарт JWT требует строку
2. Роли в базе данных хранились на русском языке ("Администратор"), а в коде ожидались английские значения ("admin")

## Исправления

### 1. Маппинг ролей (api/services/auth_service.py)
Добавлен маппинг ролей из русского в английский:
- "Администратор" → "admin"
- "Руководитель" → "manager"
- "Бригадир" → "foreman"
- "Исполнитель" → "executor"

### 2. Исправление формата JWT токена
- Поле `sub` теперь строка вместо числа
- Обновлена валидация токена для корректной обработки

## Что нужно сделать пользователю

1. **Перезагрузить страницу веб-клиента** (F5 или Ctrl+R)
2. **Выйти из системы** (если вы уже вошли)
3. **Войти заново** с учетными данными:
   - Логин: `admin`
   - Пароль: `admin`
4. **Попробовать создать смету снова**

## Проверка

Для проверки работы аутентификации можно запустить:
```bash
python test_web_auth.py
```

Должен вернуться статус 200 и список смет.

## Технические детали

### Тестирование
```bash
# Установка зависимостей
pip install requests pyjwt

# Запуск теста
python test_web_auth.py
```

### Ожидаемый результат
```
Testing estimates list WITHOUT token...
Status: 403
Response: {"detail":"Not authenticated"}

Testing login...
Status: 200
Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

Testing estimates list...
Status: 200
Success: True
Items count: 4
```
