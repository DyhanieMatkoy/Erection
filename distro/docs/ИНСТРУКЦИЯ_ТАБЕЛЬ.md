# Инструкция по работе с табелем учета рабочего времени

## Содержание

1. [Обзор](#обзор)
2. [Открытие списка табелей](#открытие-списка-табелей)
3. [Создание нового табеля](#создание-нового-табеля)
4. [Заполнение табеля](#заполнение-табеля)
5. [Автозаполнение из ежедневных отчетов](#автозаполнение-из-ежедневных-отчетов)
6. [Проведение табеля](#проведение-табеля)
7. [Отмена проведения](#отмена-проведения)
8. [Печать табеля](#печать-табеля)
9. [Права доступа](#права-доступа)
10. [Предотвращение дублирования](#предотвращение-дублирования)

## Обзор

Табель учета рабочего времени предназначен для фиксации отработанных часов сотрудниками бригады за календарный месяц. Документ позволяет:

- Вести учет рабочего времени по дням месяца
- Автоматически рассчитывать итоговые показатели
- Заполнять данные из ежедневных отчетов
- Проводить документ для создания начислений
- Контролировать уникальность записей

## Открытие списка табелей

### Шаг 1: Открыть меню "Документы"

В главном окне программы выберите меню **Документы** → **Табель** или нажмите сочетание клавиш **Ctrl+Shift+T**.

### Шаг 2: Просмотр списка

В открывшемся окне отображается список табелей с колонками:

- **Номер** - номер документа
- **Дата** - дата документа
- **Объект** - объект строительства
- **Смета** - номер сметы
- **Бригадир** - ответственный бригадир
- **Проведен** - статус проведения (✓ или пусто)

### Шаг 3: Фильтрация

Используйте фильтры для поиска нужных табелей:

- **Период** - выберите диапазон дат
- **Объект** - выберите объект из списка
- **Проведен** - фильтр по статусу проведения

## Создание нового табеля

### Шаг 1: Нажать кнопку "Создать"

В окне списка табелей нажмите кнопку **Создать** на панели инструментов.

### Шаг 2: Заполнить реквизиты

В открывшейся форме документа заполните обязательные поля:

1. **Номер** - автоматически генерируется, можно изменить
2. **Дата** - выберите дату (определяет месяц учета)
3. **Объект** - выберите объект строительства из справочника
4. **Смета** - выберите смету (список фильтруется по выбранному объекту)

**Важно:** Дата документа определяет месяц, за который ведется учет. Например, если выбрана дата 15.03.2024, табель будет создан для марта 2024 года.

### Шаг 3: Сохранить документ

Нажмите кнопку **Сохранить** на панели инструментов или нажмите **Ctrl+S**.

## Заполнение табеля

### Добавление сотрудников

#### Способ 1: Вручную

1. Нажмите кнопку **Добавить сотрудника** под таблицей
2. В открывшемся окне подбора выберите сотрудника
3. Используйте чекбокс **"Показать всех сотрудников"** для выбора режима фильтрации:
   - Снят - показываются только сотрудники вашей бригады
   - Установлен - показываются все сотрудники
4. Нажмите **OK**

Сотрудник будет добавлен в таблицу с автоматически подставленной тарифной ставкой из справочника.

#### Способ 2: Автозаполнение

См. раздел [Автозаполнение из ежедневных отчетов](#автозаполнение-из-ежедневных-отчетов).

### Ввод отработанных часов

1. В таблице найдите строку нужного сотрудника
2. В колонках с номерами дней (1, 2, 3, ..., 31) введите количество отработанных часов
3. Используйте клавиши **Tab** или **Enter** для перехода между ячейками

**Правила ввода:**

- Допускаются только числа от 0 до 24
- Можно вводить дробные значения (например, 7.5)
- Выходные дни выделены другим цветом в заголовках
- Неиспользуемые дни (для месяцев < 31 дня) скрыты

### Автоматический расчет

При вводе часов система автоматически рассчитывает:

- **Итого** - сумма всех отработанных часов за месяц
- **Сумма** - итого × тарифная ставка

Расчет происходит в режиме реального времени при изменении любого значения.

### Изменение тарифной ставки

Если нужно изменить тарифную ставку для конкретного сотрудника:

1. Кликните на ячейку в колонке **Ставка**
2. Введите новое значение
3. Нажмите **Enter**

Сумма начисления пересчитается автоматически.

## Автозаполнение из ежедневных отчетов

Функция автозаполнения позволяет автоматически заполнить табель данными из ежедневных отчетов за месяц.

### Шаг 1: Убедиться, что выбраны объект и смета

Перед использованием автозаполнения должны быть заполнены поля **Объект** и **Смета**.

### Шаг 2: Нажать кнопку "Заполнить из ежедневных отчетов"

На панели инструментов нажмите кнопку **Заполнить из ежедневных отчетов**.

### Шаг 3: Подтвердить действие

Если таблица уже содержит данные, система запросит подтверждение:

```
Таблица уже содержит данные. Заменить их?
[Да] [Нет]
```

- **Да** - текущие данные будут заменены
- **Нет** - операция отменяется

### Как работает автозаполнение

1. Система находит все ежедневные отчеты по выбранным объекту и смете за месяц
2. Извлекает уникальный список сотрудников-исполнителей
3. Для каждого сотрудника суммирует фактические трудозатраты по дням
4. Если в отчете указано несколько исполнителей, часы распределяются пропорционально
5. Добавляет сотрудников в таблицу с заполненными часами
6. Подставляет тарифные ставки из справочника

**Пример:**

Ежедневный отчет от 15.03.2024:
- Работа: Кладка кирпича
- Фактические трудозатраты: 16 часов
- Исполнители: Иванов И.И., Петров П.П.

Результат в табеле:
- Иванов И.И., день 15: 8 часов
- Петров П.П., день 15: 8 часов

## Проведение табеля

Проведение документа создает записи в регистре начислений и удержаний.

### Шаг 1: Проверить данные

Убедитесь, что:
- Все обязательные поля заполнены
- В таблице есть хотя бы один сотрудник с ненулевыми часами
- Данные введены корректно

### Шаг 2: Нажать кнопку "Провести"

На панели инструментов нажмите кнопку **Провести**.

### Шаг 3: Дождаться результата

Система выполнит следующие действия:

1. Проверит наличие дублирующих записей в регистре
2. Создаст записи в регистре начислений для каждого дня с ненулевыми часами
3. Установит флаг "Проведен" и зафиксирует дату/время проведения
4. Заблокирует редактирование документа

**Успешное проведение:**

```
✓ Табель успешно проведен
```

**Ошибка дублирования:**

```
✗ Ошибка проведения: обнаружены дублирующие записи
Сотрудник: Иванов И.И.
Дата: 15.03.2024
Конфликтующий документ: Табель №5 от 01.03.2024
```

### Что происходит при проведении

Для каждого сотрудника и каждого дня с ненулевыми часами создается запись в регистре:

- **Объект** - из шапки документа
- **Смета** - из шапки документа
- **Сотрудник** - из строки таблицы
- **Дата работы** - конкретный день месяца
- **Отработано часов** - значение из ячейки
- **Сумма** - часы × тарифная ставка

## Отмена проведения

Отмена проведения позволяет исправить ошибки в документе.

### Шаг 1: Открыть проведенный документ

В списке табелей откройте документ со статусом "Проведен".

### Шаг 2: Нажать кнопку "Отменить проведение"

На панели инструментов нажмите кнопку **Отменить проведение**.

### Шаг 3: Подтвердить действие

Система запросит подтверждение:

```
Отменить проведение документа?
Все записи в регистре начислений будут удалены.
[Да] [Нет]
```

### Что происходит при отмене

1. Удаляются все записи из регистра начислений, созданные этим документом
2. Снимается флаг "Проведен"
3. Очищается дата/время проведения
4. Разблокируется редактирование документа

После отмены проведения можно внести изменения и провести документ заново.

## Печать табеля

### Шаг 1: Открыть документ

Откройте табель, который нужно распечатать.

### Шаг 2: Нажать кнопку "Печать"

На панели инструментов нажмите кнопку **Печать** или нажмите **Ctrl+P**.

### Шаг 3: Просмотр и печать

Система сгенерирует файл Excel с печатной формой табеля:

- Шапка документа (номер, дата, объект, смета)
- Таблица с сотрудниками и отработанными часами
- Колонки для каждого дня месяца
- Итоговые значения по каждому сотруднику
- Общая итоговая строка

Файл откроется в программе Excel, где вы сможете:
- Просмотреть документ
- Отправить на печать
- Сохранить в нужном формате

## Права доступа

Система поддерживает разграничение прав доступа к табелям.

### Роль: Бригадир

**Может:**
- Просматривать только свои табели (где он указан как бригадир)
- Создавать новые табели (автоматически назначается ответственным)
- Редактировать свои непроведенные табели
- Проводить и отменять проведение своих табелей
- Печатать свои табели

**Не может:**
- Просматривать табели других бригадиров
- Редактировать чужие табели

### Роль: Администратор

**Может:**
- Просматривать все табели
- Создавать табели для любого бригадира
- Редактировать любые непроведенные табели
- Проводить и отменять проведение любых табелей
- Печатать любые табели
- Удалять табели

### Фильтрация сотрудников

При добавлении сотрудников в табель доступны два режима:

**"Только моя бригада"** (по умолчанию для бригадиров):
- Показываются сотрудники, где текущий пользователь указан как руководитель
- Показываются сотрудники без руководителя
- Упрощает выбор для бригадира

**"Показать всех сотрудников"**:
- Показываются все сотрудники из справочника
- Полезно, если нужно добавить сотрудника из другой бригады

Выбранный режим сохраняется для каждого пользователя.

## Предотвращение дублирования

Система контролирует уникальность записей в регистре начислений.

### Уникальный ключ

Каждая запись в регистре идентифицируется комбинацией:
- Объект
- Смета
- Сотрудник
- Дата работы

### Проверка при проведении

Перед проведением система проверяет:

1. Существуют ли в регистре записи с такой же комбинацией ключевых полей
2. Если найдены дубликаты, проведение отменяется
3. Выводится сообщение с указанием конфликтующих записей

### Пример конфликта

**Ситуация:**

1. Создан и проведен Табель №5 от 01.03.2024
   - Объект: Жилой дом
   - Смета: СМ-001
   - Сотрудник: Иванов И.И., 15.03.2024, 8 часов

2. Создается Табель №6 от 15.03.2024
   - Объект: Жилой дом
   - Смета: СМ-001
   - Сотрудник: Иванов И.И., 15.03.2024, 8 часов

**Результат:**

При попытке провести Табель №6 система выдаст ошибку:

```
✗ Ошибка проведения: обнаружены дублирующие записи

Конфликтующие записи:
- Сотрудник: Иванов И.И.
- Дата: 15.03.2024
- Существующий документ: Табель №5 от 01.03.2024

Для проведения документа необходимо:
1. Отменить проведение конфликтующего документа, или
2. Изменить данные в текущем документе
```

### Как избежать дублирования

1. **Проверяйте существующие табели** перед созданием нового
2. **Используйте один табель на месяц** для каждой комбинации объект+смета
3. **Отменяйте проведение** старого документа перед созданием нового с теми же данными
4. **Используйте автозаполнение** - оно автоматически агрегирует данные из всех отчетов

### Исправление дублирования

Если возникла ошибка дублирования:

**Вариант 1: Отменить проведение старого документа**

1. Найдите конфликтующий документ (указан в сообщении об ошибке)
2. Откройте его
3. Нажмите "Отменить проведение"
4. Вернитесь к новому документу и проведите его

**Вариант 2: Изменить данные**

1. Измените дату работы сотрудника
2. Или удалите конфликтующую строку
3. Или измените объект/смету

**Вариант 3: Объединить документы**

1. Отмените проведение обоих документов
2. Перенесите данные в один документ
3. Удалите дублирующий документ
4. Проведите объединенный документ

## Часто задаваемые вопросы

### Можно ли изменить проведенный табель?

Нет, проведенный документ заблокирован для редактирования. Сначала нужно отменить проведение.

### Что делать, если забыл добавить сотрудника?

1. Отмените проведение документа
2. Добавьте сотрудника
3. Заполните его часы
4. Проведите документ заново

### Можно ли вести несколько табелей на один месяц?

Да, но для разных объектов или смет. Для одной комбинации объект+смета рекомендуется использовать один табель на месяц.

### Как исправить ошибку в часах после проведения?

1. Отмените проведение
2. Исправьте данные
3. Проведите заново

### Почему не все дни месяца отображаются?

Система автоматически скрывает неиспользуемые дни. Например, в феврале будет 28 или 29 дней, а не 31.

### Можно ли удалить проведенный табель?

Нет, сначала нужно отменить проведение, затем удалить.

### Как узнать, из какого документа взялись данные в регистре?

В регистре начислений хранится ссылка на документ-регистратор (тип и номер документа).

## Техническая поддержка

При возникновении проблем или вопросов обращайтесь к администратору системы.
