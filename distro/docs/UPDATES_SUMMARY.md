# Обновления системы

## Выполненные изменения

### 1. Горизонтальная ориентация печатных форм
- **Файлы**: `src/services/print_form_generator.py`, `src/services/estimate_print_form.py`, `src/services/daily_report_print_form.py`
- **Изменения**: 
  - Добавлен параметр `orientation` в конструктор `PrintFormGenerator`
  - Печатные формы сметы и ежедневного отчета теперь используют горизонтальную ориентацию (`landscape`)
  - Размер страницы автоматически адаптируется под выбранную ориентацию

### 2. 12-символьный код товара
- **Файлы**: `src/data/database_manager.py`, `src/services/excel_import_service.py`, `src/services/estimate_print_form.py`, `src/views/work_form.py`
- **Изменения**:
  - Добавлено поле `code` (TEXT, 12 символов) в таблицу `works`
  - При импорте из Excel код извлекается из колонки "Код" и сохраняется в справочнике Работы
  - Код отображается в печатной форме сметы
  - Добавлено поле "Код" в форму редактирования работы с ограничением в 12 символов
  - При поиске работы по коду система обновляет существующую запись или создает новую

### 3. Кнопка по умолчанию с хоткеем Ctrl+Enter
- **Файлы**: Все формы документов и справочников
- **Изменения**:
  - Кнопка "Сохранить и закрыть" установлена как кнопка по умолчанию (`setDefault(True)`)
  - Добавлена обработка хоткея Ctrl+Enter во всех формах:
    - `src/views/base_document_form.py` - базовая форма документов
    - `src/views/work_form.py` - форма работы
    - `src/views/person_form.py` - форма физлица
    - `src/views/object_form.py` - форма объекта
    - `src/views/organization_form.py` - форма организации
    - `src/views/counterparty_form.py` - форма контрагента
  - При нажатии Ctrl+Enter вызывается метод `on_save_and_close()`

## Обновленные требования

Файл `.kiro/specs/construction-time-management/requirements.md` обновлен:

1. **Требование 1, критерий 4**: Добавлено требование горизонтальной ориентации печатной формы сметы
2. **Требование 2, критерий 5**: Добавлено требование горизонтальной ориентации печатной формы ежедневного отчета
3. **Требование 4, критерий 4**: Добавлено поле "Код" (12 символов) в справочник Работы
4. **Требование 4, критерий 11**: Добавлено требование загрузки кода товара из Excel
5. **Требование 9, критерий 2**: Добавлен хоткей Ctrl+Enter для кнопки по умолчанию
6. **Требование 9, критерий 11**: Уточнено поведение Ctrl+Enter в формах
7. **Требование 9, критерий 16**: Добавлено требование установки кнопки по умолчанию

### 4. Колонка "Проведен" первой в списках документов
- **Файлы**: `src/views/estimate_list_form.py`, `src/views/daily_report_list_form.py`
- **Изменения**:
  - Колонка "Проведен" перемещена на первое место в таблице
  - Колонка "ID" перемещена в конец и скрыта
  - Обновлены все ссылки на индексы колонок в коде
  - Проведенные документы выделяются жирным шрифтом в колонке статуса

## Тестирование

Для проверки изменений:

1. **Печатные формы**: Откройте смету или ежедневный отчет и нажмите "Печать" - документ должен быть в горизонтальной ориентации
2. **Код товара**: 
   - Импортируйте смету из Excel - коды должны загрузиться
   - Откройте форму работы - должно быть поле "Код" с ограничением 12 символов
   - Печатная форма сметы должна отображать коды работ
3. **Ctrl+Enter**: В любой форме документа или справочника нажмите Ctrl+Enter - должно произойти сохранение и закрытие формы
4. **Колонка "Проведен"**: Откройте список смет или ежедневных отчетов - первая колонка должна показывать статус проведения (✓ для проведенных)
