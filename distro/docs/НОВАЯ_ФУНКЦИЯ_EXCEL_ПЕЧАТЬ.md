# Новая функция: Печать в Excel формате

## Описание

Добавлена возможность выводить печатные формы смет и ежедневных отчетов в формате Excel, с поддержкой пользовательских шаблонов.

## Основные возможности

### 1. Выбор формата печати

В настройках можно выбрать формат вывода:
- **PDF** - для печати и просмотра (по умолчанию)
- **Excel** - для редактирования и обработки данных

### 2. Шаблоны печатных форм

При выборе Excel формата программа использует шаблоны из папки `PrnForms`:
- `estimate_template.xlsx` - шаблон сметы
- `daily_report_template.xlsx` - шаблон ежедневного отчета

Если шаблоны отсутствуют, документы создаются автоматически.

### 3. Кнопка "Создать шаблоны"

В диалоге настроек есть кнопка для автоматического создания стандартных шаблонов.
После создания шаблоны можно редактировать в Excel для настройки внешнего вида.

## Где найти

### Настройки печати

Кнопка **"Настройки печати"** находится в формах:
- Список смет
- Список ежедневных отчетов

### Печать документа

Кнопка **"Печать"** (Ctrl+P) в формах:
- Документ сметы
- Документ ежедневного отчета

## Инструкция по использованию

### Шаг 1: Настройка

1. Откройте список смет или отчетов
2. Нажмите **"Настройки печати"**
3. Выберите формат **"Excel"**
4. Нажмите **"Сохранить"**

### Шаг 2: Создание шаблонов (опционально)

1. В окне настроек нажмите **"Создать шаблоны печатных форм"**
2. Подтвердите создание
3. Шаблоны появятся в папке `PrnForms`

### Шаг 3: Настройка шаблонов (опционально)

1. Откройте файлы из папки `PrnForms` в Excel
2. Измените форматирование, цвета, шрифты
3. Добавьте логотип компании
4. Сохраните изменения

### Шаг 4: Печать

1. Откройте смету или отчет
2. Нажмите **"Печать"** (Ctrl+P)
3. Документ откроется в Excel

## Преимущества Excel формата

✅ Можно редактировать данные после создания  
✅ Легко отправить по email  
✅ Импорт в другие программы  
✅ Полная настройка внешнего вида через шаблоны  
✅ Добавление логотипов и изображений  
✅ Использование формул Excel  

## Настройка шаблонов

### Плейсхолдеры (метки для замены)

В шаблонах можно использовать специальные метки, которые будут заменены на реальные данные:

**Для сметы:**
```
{NUMBER}      → номер сметы
{DATE}        → дата сметы
{OBJECT}      → наименование объекта
{CUSTOMER}    → заказчик
{CONTRACTOR}  → подрядчик
{TOTAL_SUM}   → итоговая сумма
{TOTAL_LABOR} → итоговые трудозатраты
```

**Для ежедневного отчета:**
```
{DATE}            → дата отчета
{ESTIMATE_NUMBER} → номер сметы
{ESTIMATE_DATE}   → дата сметы
{OBJECT}          → объект
{FOREMAN}         → бригадир
```

### Пример настройки шаблона

1. Откройте `estimate_template.xlsx`
2. В ячейке A1 напишите: `Смета №{NUMBER} от {DATE}`
3. Добавьте логотип компании (Вставка → Изображение)
4. Измените цвета заголовков таблицы
5. Сохраните файл
6. При следующей печати будет использован ваш шаблон

## Конфигурация

Настройки хранятся в файле `env.ini`:

```ini
[PrintForms]
# Формат: PDF или Excel
format=PDF
# Путь к папке с шаблонами
templates_path=PrnForms
```

Можно изменить путь к шаблонам, если нужно хранить их в другом месте.

## Часто задаваемые вопросы

**Q: Можно ли использовать оба формата?**  
A: Да, переключайтесь между PDF и Excel в любое время через настройки.

**Q: Что если не создавать шаблоны?**  
A: Программа автоматически создаст документ с базовым форматированием.

**Q: Можно ли добавить формулы в шаблон?**  
A: Да, но данные в таблице будут перезаписаны. Формулы лучше размещать в итоговой секции.

**Q: Шаблон не работает, что делать?**  
A: Удалите файл шаблона - программа создаст документ автоматически. Затем создайте шаблон заново.

**Q: Можно ли использовать шаблоны для разных объектов?**  
A: Да, один шаблон используется для всех документов данного типа.

## Техническая информация

### Новые файлы

- `src/services/excel_print_form_generator.py`
- `src/services/excel_estimate_print_form.py`
- `src/services/excel_daily_report_print_form.py`
- `src/services/print_form_service.py`
- `src/views/print_settings_dialog.py`

### Изменённые файлы

- `env.ini` - добавлена секция `[PrintForms]`
- `src/views/estimate_list_form.py` - кнопка настроек
- `src/views/estimate_document_form.py` - обновлена печать
- `src/views/daily_report_list_form.py` - кнопка настроек
- `src/views/daily_report_document_form.py` - обновлена печать

### Зависимости

Используется библиотека `openpyxl` (уже в requirements.txt)

## Поддержка

При возникновении проблем:
1. Проверьте, что установлен Excel или LibreOffice
2. Убедитесь, что файлы шаблонов не открыты в другой программе
3. Попробуйте пересоздать шаблоны
4. Проверьте права доступа к папке `PrnForms`
