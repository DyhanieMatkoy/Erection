# Руководство по запуску Desktop версии с другого хоста по сети

## Обзор

Desktop приложение работает напрямую с базой данных, поэтому для сетевого доступа необходимо настроить удаленное подключение к базе данных. Есть несколько вариантов решения:

## Вариант 1: Использование PostgreSQL (Рекомендуется)

### На сервере (где находится база данных):

1. **Установите PostgreSQL**:
   ```bash
   # Windows
   # Скачайте с https://www.postgresql.org/download/windows/
   
   # Ubuntu/Debian
   sudo apt update
   sudo apt install postgresql postgresql-contrib
   ```

2. **Мигрируйте данные в PostgreSQL**:
   ```cmd
   migrate_to_postgresql.bat
   ```

3. **Настройте PostgreSQL для сетевого доступа**:
   
   Отредактируйте `postgresql.conf`:
   ```
   listen_addresses = '*'
   port = 5432
   ```
   
   Отредактируйте `pg_hba.conf`:
   ```
   # Разрешить подключения с любого IP (настройте под свои нужды)
   host    all             all             0.0.0.0/0               md5
   ```

4. **Перезапустите PostgreSQL**:
   ```cmd
   net stop postgresql-x64-14
   net start postgresql-x64-14
   ```

5. **Откройте порт в брандмауэре**:
   ```cmd
   netsh advfirewall firewall add rule name="PostgreSQL" dir=in action=allow protocol=TCP localport=5432
   ```

### На клиентском компьютере:

1. **Скопируйте файлы приложения**:
   - Скопируйте всю папку проекта на клиентский компьютер
   - Установите Python и зависимости из `requirements.txt`

2. **Настройте подключение к базе данных**:
   
   Создайте файл `env.ini` с настройками подключения:
   ```ini
   [database]
   type = postgresql
   host = IP_АДРЕС_СЕРВЕРА
   port = 5432
   database = construction
   username = postgres
   password = ВАШ_ПАРОЛЬ
   ```

3. **Запустите приложение**:
   ```cmd
   python main.py
   ```

## Вариант 2: Использование SQL Server

### На сервере:

1. **Установите SQL Server Express**:
   - Скачайте с официального сайта Microsoft
   - Включите TCP/IP протокол в SQL Server Configuration Manager

2. **Мигрируйте данные**:
   ```cmd
   migrate_to_mssql.bat
   ```

3. **Настройте сетевой доступ**:
   - Откройте SQL Server Configuration Manager
   - Включите TCP/IP для SQL Server Network Configuration
   - Установите порт 1433
   - Перезапустите службу SQL Server

4. **Откройте порт в брандмауэре**:
   ```cmd
   netsh advfirewall firewall add rule name="SQL Server" dir=in action=allow protocol=TCP localport=1433
   ```

### На клиентском компьютере:

Создайте файл `env.ini`:
```ini
[database]
type = mssql
host = IP_АДРЕС_СЕРВЕРА
port = 1433
database = construction
username = sa
password = ВАШ_ПАРОЛЬ
driver = ODBC Driver 17 for SQL Server
```

## Вариант 3: Общий доступ к SQLite файлу (Простой, но ограниченный)

### На сервере:

1. **Создайте сетевую папку**:
   ```cmd
   # Создайте папку и откройте общий доступ
   mkdir C:\ConstructionDB
   net share ConstructionDB=C:\ConstructionDB /grant:everyone,full
   ```

2. **Скопируйте базу данных**:
   ```cmd
   copy construction.db C:\ConstructionDB\
   ```

### На клиентском компьютере:

1. **Подключите сетевой диск**:
   ```cmd
   net use Z: \\IP_АДРЕС_СЕРВЕРА\ConstructionDB
   ```

2. **Измените путь к базе в коде**:
   В файле `main.py` измените:
   ```python
   db_manager.initialize("Z:\\construction.db")
   ```

**⚠️ Внимание**: SQLite не предназначен для одновременного доступа нескольких пользователей. Могут возникнуть блокировки и потеря данных.

## Вариант 4: Использование API (Требует доработки)

Для полноценного сетевого доступа через API потребуется:

1. **Запустить API сервер на сервере**:
   ```cmd
   python start_server.py
   ```

2. **Доработать Desktop приложение** для работы через HTTP API вместо прямого доступа к базе данных.

## Рекомендации

1. **Для производственного использования**: PostgreSQL (Вариант 1)
2. **Для тестирования**: SQL Server (Вариант 2)
3. **Для временного решения**: Общий SQLite файл (Вариант 3)
4. **Для будущего развития**: API подход (Вариант 4)

## Безопасность

- Используйте сильные пароли для базы данных
- Настройте правильные права доступа в `pg_hba.conf` или SQL Server
- Рассмотрите использование VPN для доступа к базе данных
- Регулярно создавайте резервные копии базы данных

## Устранение неполадок

### Проблемы с подключением:
1. Проверьте, что сервер базы данных запущен
2. Проверьте настройки брандмауэра
3. Убедитесь, что порт открыт и доступен
4. Проверьте правильность IP-адреса и учетных данных

### Проблемы с производительностью:
1. Используйте PostgreSQL вместо SQLite для сетевого доступа
2. Настройте индексы в базе данных
3. Рассмотрите использование локального кэширования

### Проблемы с одновременным доступом:
1. Избегайте SQLite для множественного доступа
2. Используйте транзакции правильно
3. Рассмотрите блокировки на уровне приложения