# Исправления ошибок

## Исправленные проблемы

### 1. Ошибка открытия формы сметы
**Проблема:** При открытии формы сметы возникала ошибка из-за использования EstimateViewModel.

**Решение:**
- Убран EstimateViewModel из EstimateDocumentForm
- Прямое чтение данных из базы данных через cursor
- Упрощена логика загрузки данных
- Исправлена загрузка строк сметы из таблицы estimate_lines

**Изменённые файлы:**
- `src/views/estimate_document_form.py`

### 2. Ошибка открытия формы ежедневного отчета
**Проблема:** Аналогичная ошибка с DailyReportViewModel.

**Решение:**
- Убран DailyReportViewModel из DailyReportDocumentForm
- Прямое чтение данных из базы данных
- Исправлена загрузка строк отчета из таблицы daily_report_lines
- Корректная обработка executor_ids

**Изменённые файлы:**
- `src/views/daily_report_document_form.py`

### 3. Автологин не переходит в главную форму
**Проблема:** После успешного автологина форма входа оставалась открытой, ожидая нажатия OK.

**Решение:**
- Использован QTimer.singleShot для отложенного вызова try_auto_login
- Автологин теперь выполняется после полной инициализации UI
- При успешном автологине форма автоматически закрывается через self.accept()

**Изменённые файлы:**
- `src/views/login_form.py`

## Технические детали

### Упрощение архитектуры
Убраны промежуточные ViewModel слои, которые усложняли код без реальной пользы:
- EstimateViewModel → прямая работа с БД
- DailyReportViewModel → прямая работа с БД

Это упростило код и устранило потенциальные точки отказа.

### Автологин
Изменён порядок инициализации:
```python
# Было:
def __init__(self):
    super().__init__()
    self.auth_service = AuthService()
    self.setup_ui()
    self.try_auto_login()  # Вызывался до показа формы

# Стало:
def __init__(self):
    super().__init__()
    self.auth_service = AuthService()
    self.setup_ui()
    QTimer.singleShot(100, self.try_auto_login)  # Отложенный вызов
```

## Проверка

Приложение успешно запускается и работает:
- ✅ Автологин работает корректно
- ✅ Формы сметы открываются без ошибок
- ✅ Формы ежедневных отчетов открываются без ошибок
- ✅ Все справочники работают
- ✅ Главное окно отображается корректно

## Запуск

```bash
python main.py
```

При наличии файла `env.ini` с учетными данными произойдет автоматический вход в систему.
