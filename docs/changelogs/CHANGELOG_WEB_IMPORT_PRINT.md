# Changelog: Импорт смет и печатные формы в веб-версии

## Дата: 01.12.2025

### Добавлено

#### 1. Импорт смет из Excel
- ✅ API endpoint `/documents/estimates/import-excel` для загрузки Excel файлов
- ✅ Кнопка "Импорт из Excel" в списке смет
- ✅ Автоматическое создание справочников (заказчики, объекты, работы)
- ✅ Парсинг заголовка и строк сметы
- ✅ Расчет итоговых сумм и трудозатрат
- ✅ Автоматическое открытие импортированной сметы

#### 2. Печатные формы в списке смет
- ✅ Кнопка "Excel" для быстрой печати в Excel
- ✅ Кнопка "PDF" для быстрой печати в PDF
- ✅ Прямое скачивание без дополнительных диалогов

#### 3. Улучшения печати в форме сметы
- ✅ Диалог выбора формата печати (уже был)
- ✅ Поддержка PDF и Excel форматов
- ✅ Опции "Скачать" и "Открыть" для PDF

### Технические изменения

#### Backend (API)
```
api/endpoints/documents.py
  + import_estimate_from_excel() - новый endpoint
  + Импорты: UploadFile, File, tempfile, os
```

#### Frontend (Web)
```
web-client/src/api/documents.ts
  + importEstimateFromExcel() - новая функция

web-client/src/views/documents/EstimateListView.vue
  + Кнопка "Импорт из Excel"
  + Обработчик handleImportExcel()
  + Обработчик handleFileSelected()
  + Обработчик handlePrint()
  + Кнопки "Excel" и "PDF" в таблице
  + Скрытый input для выбора файла
```

### Используемые сервисы

Все сервисы уже существовали в десктопной версии:
- `ExcelImportService` - импорт из Excel
- `ExcelEstimatePrintForm` - печать смет в Excel
- `EstimatePrintForm` - печать смет в PDF
- `ExcelPrintFormGenerator` - базовый класс для Excel

### Файлы документации

- `WEB_IMPORT_PRINT_FORMS.md` - техническая документация
- `ИНСТРУКЦИЯ_ИМПОРТ_И_ПЕЧАТЬ.md` - инструкция для пользователей
- `CHANGELOG_WEB_IMPORT_PRINT.md` - этот файл

### Совместимость

- ✅ Полная совместимость с десктопной версией
- ✅ Использует те же сервисы и шаблоны
- ✅ Поддержка существующих Excel файлов смет
- ✅ Единый формат печатных форм

### Тестирование

Рекомендуется протестировать:
1. Импорт сметы из Excel файла
2. Печать сметы в Excel из списка
3. Печать сметы в PDF из списка
4. Печать сметы через диалог в форме
5. Открытие PDF в новой вкладке

### Известные ограничения

- Импорт поддерживает только формат Excel (.xlsx, .xls)
- Структура Excel файла должна соответствовать шаблону
- Максимальный размер загружаемого файла определяется настройками FastAPI

### Следующие шаги

Функционал готов к использованию. Возможные улучшения:
- Добавить предпросмотр перед импортом
- Поддержка импорта нескольких смет одновременно
- Настройка шаблонов печати через веб-интерфейс
- Экспорт смет в Excel для редактирования
