# Changelog: Обновления Desktop и Web версий

## Дата: 11.12.2025

### Desktop Приложение (PyQt6)

#### 1. Улучшения в смете
- ✅ При выборе работы количество автоматически устанавливается в `1.0` (ранее `0.0` или пусто).
- ✅ Улучшен поиск работ: теперь поиск работает по подстроке кода или наименования прямо в поле выбора.
- ✅ Исправлено отображение кода работы в списке выбора.

#### 2. Диалог выбора (Reference Picker)
- ✅ Добавлено контекстное меню с командой "Изменить" для быстрого редактирования справочника.
- ✅ Исправлена ошибка, из-за которой форма редактирования мгновенно закрывалась при вызове из модального окна.
- ✅ Улучшен поиск: теперь ищет по коду и наименованию одновременно.

### Web-клиент (Vue 3)

#### 1. Ежедневные отчеты (Daily Reports)
- ✅ Исправлена ошибка сервера `500 Internal Server Error` при открытии отчетов (исправлен SQL запрос).
- ✅ Исправлена ошибка `Invalid prop: type check failed for prop "disabled"` в форме отчета.

#### 2. Сметы (Estimates)
- ✅ Полностью переработан механизм выбора работ в строках сметы.
- ✅ Внедрен полноэкранный диалог выбора работ (`WorkListForm`) вместо маленького выпадающего списка.
- ✅ В списке работ теперь отображается код работы.
- ✅ Добавлен поиск по коду и наименованию.
- ✅ При выборе работы автоматически подтягиваются:
  - Единица измерения
  - Цена
  - Норма трудозатрат
- ✅ Количество по умолчанию устанавливается в `1.0`.
- ✅ Возможность повторного открытия диалога выбора кликом по названию работы.

#### 3. Табели (Timesheets)
- ✅ Исправлена ошибка `Invalid prop: type check failed for prop "data"` при пустом списке табелей.
- ✅ Исправлены TypeScript ошибки типизации в списке и форме табелей.

#### 4. Общие исправления
- ✅ Устранено более 100 ошибок TypeScript в различных компонентах.
- ✅ Улучшена стабильность работы компонентов таблиц (`DataTable`).
- ✅ Исправлена работа с пагинацией и фильтрами в справочниках.

### Технические детали

#### Backend (API)
- `api/endpoints/documents.py`: Исправлен запрос `get_daily_report_lines_with_joins` (использовалось неверное имя колонки `report_id` вместо `daily_report_id`).
- `api/models/work_specification.py`: Обновлена модель `WorkSpecification` для поддержки новых полей.

#### Frontend (Web)
- `EstimateLines.vue`: Интеграция `WorkListForm` вместо `Picker`.
- `DailyReportFormView.vue`: Исправление приведения типов для `disabled` пропов.
- `useTable.ts`: Исправление типизации данных.
- `types/models.ts`: Обновление интерфейсов `Timesheet` и `Work`.

#### Desktop (PyQt6)
- `estimate_document_form.py`: Логика дефолтного количества и поиска.
- `reference_picker_dialog.py`: Исправление модальности и добавление контекстного меню.
