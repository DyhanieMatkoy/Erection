# Резюме: Добавлена поддержка печати в Excel

## Что сделано

### 1. Новые файлы

**Сервисы:**
- `src/services/excel_print_form_generator.py` - базовый класс для Excel форм
- `src/services/excel_estimate_print_form.py` - генератор сметы в Excel
- `src/services/excel_daily_report_print_form.py` - генератор ежедневного отчета в Excel
- `src/services/print_form_service.py` - унифицированный сервис печати

**Интерфейс:**
- `src/views/print_settings_dialog.py` - диалог настроек печати

**Документация:**
- `PRINT_FORMS_EXCEL.md` - подробная документация
- `ИНСТРУКЦИЯ_ПЕЧАТЬ_EXCEL.md` - краткая инструкция на русском

**Тесты:**
- `test_excel_print.py` - тестовый скрипт

### 2. Изменённые файлы

**Конфигурация:**
- `env.ini` - добавлена секция `[PrintForms]` с настройками формата и пути к шаблонам

**Формы:**
- `src/views/estimate_list_form.py` - добавлена кнопка "Настройки печати"
- `src/views/estimate_document_form.py` - обновлена функция печати
- `src/views/daily_report_list_form.py` - добавлена кнопка "Настройки печати"
- `src/views/daily_report_document_form.py` - обновлена функция печати

### 3. Новая функциональность

#### Выбор формата печати
- PDF (по умолчанию) - для печати и просмотра
- Excel - для редактирования и обработки

#### Шаблоны печатных форм
- Автоматическое создание шаблонов
- Поддержка пользовательских шаблонов
- Плейсхолдеры для подстановки данных
- Возможность настройки внешнего вида

#### Настройки
- Диалог настроек печати
- Кнопка создания шаблонов
- Сохранение настроек в `env.ini`

## Как использовать

### Быстрый старт

1. **Откройте настройки печати:**
   - Список смет → "Настройки печати"
   - Или список ежедневных отчетов → "Настройки печати"

2. **Выберите формат:**
   - PDF - для печати
   - Excel - для редактирования

3. **Создайте шаблоны (опционально):**
   - Нажмите "Создать шаблоны печатных форм"
   - Шаблоны будут созданы в папке `PrnForms`

4. **Печатайте документы:**
   - Откройте документ
   - Нажмите "Печать" (Ctrl+P)
   - Документ откроется в выбранном формате

### Настройка шаблонов

1. Откройте файлы в папке `PrnForms`:
   - `estimate_template.xlsx` - шаблон сметы
   - `daily_report_template.xlsx` - шаблон отчета

2. Отредактируйте в Excel:
   - Измените форматирование
   - Добавьте логотип
   - Настройте цвета и шрифты

3. Сохраните файлы

4. При следующей печати будут использованы ваши шаблоны

## Технические детали

### Архитектура

```
PrintFormService (главный сервис)
    ├── PDF генераторы
    │   ├── EstimatePrintForm
    │   └── DailyReportPrintForm
    └── Excel генераторы
        ├── ExcelEstimatePrintForm
        └── ExcelDailyReportPrintForm
```

### Конфигурация (env.ini)

```ini
[Auth]
login=admin
password=admin

[PrintForms]
format=PDF
templates_path=PrnForms
```

### Плейсхолдеры

**Смета:**
- `{NUMBER}`, `{DATE}`, `{OBJECT}`, `{CUSTOMER}`, `{CONTRACTOR}`

**Отчет:**
- `{DATE}`, `{ESTIMATE_NUMBER}`, `{ESTIMATE_DATE}`, `{OBJECT}`, `{FOREMAN}`

## Преимущества

✅ **Гибкость** - выбор между PDF и Excel  
✅ **Настройка** - полная кастомизация через шаблоны  
✅ **Простота** - работает "из коробки" без шаблонов  
✅ **Совместимость** - Excel файлы открываются везде  
✅ **Редактирование** - можно изменить данные после создания  

## Тестирование

Запустите тест:
```bash
python test_excel_print.py
```

Тест проверяет:
- Создание и чтение настроек
- Генерацию шаблонов
- Работу сервисов

## Зависимости

Все необходимые библиотеки уже в `requirements.txt`:
- `openpyxl==3.1.2` - для работы с Excel

## Примечания

- Шаблоны создаются автоматически при первом использовании
- Если шаблон не найден, документ создается программно
- Формат можно менять в любое время
- Изменения в шаблонах применяются сразу
