# Исправления веб-версии табеля

**Дата:** 25 ноября 2025

## Исправленные проблемы

### 1. Список смет не обновлялся при выборе объекта ✅

**Проблема:** В веб-версии табеля при выборе объекта список смет оставался пустым и не обновлялся.

**Причина:** Отсутствовал обработчик события изменения объекта, который должен был сбрасывать выбранную смету и обновлять список.

**Решение:**
- Добавлен обработчик `@update:model-value="handleObjectChange"` на компонент Picker для объекта
- Создана функция `handleObjectChange()`, которая сбрасывает `estimate_id` в 0 при изменении объекта
- Computed свойство `filteredEstimates` автоматически фильтрует сметы по выбранному `object_id`

**Файл:** `web-client/src/views/documents/TimesheetFormView.vue`

### 2. Отсутствие горизонтальной прокрутки для колонок дней ✅

**Проблема:** На узких экранах невозможно было увидеть все колонки дней месяца (1-31) и итоговые колонки справа.

**Решение:**
Полностью переработана структура таблицы с разделением на три секции:

1. **Левая фиксированная секция** (не прокручивается):
   - Сотрудник
   - Ставка

2. **Центральная прокручиваемая секция** (горизонтальная прокрутка):
   - Колонки дней месяца (1-31)
   - Выходные дни выделены красным фоном

3. **Правая фиксированная секция** (не прокручивается):
   - Итого часов
   - Сумма
   - Действия (кнопка "Удалить")

**Технические детали:**
- Использован flexbox для создания трех независимых секций
- Каждая секция содержит свою таблицу для синхронизации высоты строк
- Средняя секция имеет `overflow-x-auto` для горизонтальной прокрутки
- Добавлены границы между секциями для визуального разделения

**Файл:** `web-client/src/components/documents/TimesheetLines.vue`

## Дополнительные улучшения

### Исправления TypeScript

- Добавлены проверки на `undefined` в функциях `daysInMonth` и `isWeekend`
- Исправлена типизация в функции `recalculateLine`
- Добавлена проверка существования строки перед обновлением

### Улучшения UX

- Выходные дни (суббота, воскресенье) выделены красным фоном
- Итоговые колонки выделены синим фоном
- Строка итогов внизу таблицы выделена серым фоном
- Улучшена читаемость на узких экранах

## Тестирование

### Проверка выбора сметы:
1. Откройте форму табеля
2. Выберите объект → список смет должен заполниться
3. Измените объект → список смет должен обновиться
4. Поле "Смета" должно сброситься

### Проверка прокрутки:
1. Откройте табель с данными
2. Уменьшите ширину окна браузера
3. Прокрутите колонки дней горизонтально
4. Убедитесь, что колонки "Сотрудник" и "Итого/Сумма" остаются видимыми

## Команды

```bash
cd web-client
npm install
npm run dev      # Запуск dev-сервера
npm run build    # Сборка для продакшена
```

## Измененные файлы

1. `web-client/src/views/documents/TimesheetFormView.vue`
2. `web-client/src/components/documents/TimesheetLines.vue`
