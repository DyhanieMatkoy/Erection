# Импорт работ из CSV в веб-интерфейсе

## Описание

Функция импорта работ из CSV файла доступна в веб-интерфейсе в разделе "Справочники" → "Работы".

## Как использовать

### 1. Откройте справочник работ

Перейдите в раздел **Справочники** → **Работы** в боковом меню.

### 2. Нажмите кнопку "Импорт CSV"

В правом верхнем углу таблицы работ найдите кнопку **"Импорт CSV"** (с иконкой загрузки).

### 3. Выберите файл

В открывшемся модальном окне:
- Нажмите на поле выбора файла
- Выберите CSV файл с вашего компьютера

### 4. Настройте параметры импорта

**Родительская группа (необязательно)**
- Если вы хотите импортировать все работы в определенную группу, выберите её из списка
- Если оставить пустым, работы будут группироваться по полю "Тип работ" из CSV

**Пропускать существующие работы**
- Если галочка установлена (по умолчанию), существующие работы будут пропущены
- Если галочка снята, существующие работы будут обновлены

### 5. Нажмите "Импортировать"

После завершения импорта вы увидите результат:
- Количество добавленных работ
- Количество пропущенных работ
- Список ошибок (если есть)

## Формат CSV файла

CSV файл должен иметь следующую структуру:

```csv
Тип работ;Наименование работы;Цена;Единица измерения
Электромонтажные работы;монтаж розетки (220 В);500;руб.
Электромонтажные работы;монтаж выключателя (220 В);500;руб.
Сантехнические работы;установка унитаза;1500;руб.
```

### Требования к формату:

1. **Разделитель**: точка с запятой (;)
2. **Кодировка**: UTF-8
3. **Заголовок**: первая строка должна содержать названия колонок

### Колонки:

- **Тип работ** - категория/группа работ (необязательно)
  - Если указан, работы будут сгруппированы по этому полю
  - Если не указан, работы будут добавлены в корень или в выбранную родительскую группу

- **Наименование работы** - название работы (обязательно)
  - Не может быть пустым

- **Цена** - стоимость работы
  - Может содержать текст (например, "500 руб."), будут извлечены только цифры
  - Если не указана, будет установлена в 0

- **Единица измерения** - единица измерения
  - Текст "руб." и "руб/" будет автоматически удален
  - Например, "руб/м2" → "м2"

## Примеры использования

### Пример 1: Импорт с автоматической группировкой

Файл содержит колонку "Тип работ", работы будут автоматически сгруппированы:

```csv
Тип работ;Наименование работы;Цена;Единица измерения
Электромонтажные работы;монтаж розетки;500;руб.
Электромонтажные работы;монтаж выключателя;500;руб.
Сантехнические работы;установка унитаза;1500;руб.
```

Результат:
- Группа "Электромонтажные работы"
  - монтаж розетки (500)
  - монтаж выключателя (500)
- Группа "Сантехнические работы"
  - установка унитаза (1500)

### Пример 2: Импорт в выбранную группу

Выберите родительскую группу в интерфейсе, все работы будут добавлены в неё:

```csv
Тип работ;Наименование работы;Цена;Единица измерения
;монтаж розетки;500;руб.
;монтаж выключателя;500;руб.
;установка унитаза;1500;руб.
```

Все работы будут добавлены в выбранную группу.

### Пример 3: Импорт с обновлением

Снимите галочку "Пропускать существующие работы", чтобы обновить цены и единицы измерения существующих работ.

## Обработка ошибок

Если при импорте возникли ошибки, они будут отображены в результатах:

- **Пустое наименование работы** - строка пропущена
- **Ошибка кодировки** - файл должен быть в UTF-8
- **Неверный формат** - проверьте разделитель (должна быть точка с запятой)

## Советы

1. **Используйте пример файла** - файл `умелец.csv` в корне проекта содержит примеры работ
2. **Проверьте кодировку** - файл должен быть в UTF-8 (можно открыть в Notepad++ и проверить)
3. **Начните с малого** - сначала импортируйте несколько работ для проверки
4. **Используйте пропуск существующих** - это безопаснее, чем обновление

## API Endpoint

Для программного доступа используйте:

```
POST /api/references/works/import-csv
```

Параметры:
- `file` - CSV файл (multipart/form-data)
- `parent_id` - ID родительской группы (необязательно)
- `skip_existing` - пропускать существующие работы (по умолчанию true)

Ответ:
```json
{
  "success": true,
  "message": "Import completed: 10 added, 5 skipped",
  "added": 10,
  "skipped": 5,
  "errors": []
}
```
