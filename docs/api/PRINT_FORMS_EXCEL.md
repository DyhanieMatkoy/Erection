# Печатные формы в формате Excel

## Обзор

Добавлена поддержка печатных форм в формате Excel с возможностью использования пользовательских шаблонов.

## Возможности

### 1. Выбор формата печати

В настройках печатных форм можно выбрать один из двух форматов:
- **PDF** - стандартный формат для печати (по умолчанию)
- **Excel** - формат для редактирования и дальнейшей обработки

### 2. Шаблоны печатных форм

При выборе формата Excel программа может использовать шаблоны из папки `PrnForms`:
- `estimate_template.xlsx` - шаблон для сметы
- `daily_report_template.xlsx` - шаблон для ежедневного отчета

Если шаблоны не найдены, документы создаются автоматически с базовым форматированием.

### 3. Создание шаблонов

Кнопка **"Создать шаблоны печатных форм"** создает стандартные шаблоны в папке `PrnForms`.
После создания шаблоны можно редактировать в Excel для настройки:
- Форматирования ячеек
- Ширины столбцов
- Цветов и шрифтов
- Логотипов и изображений

## Использование

### Настройка формата печати

1. Откройте форму списка смет или ежедневных отчетов
2. Нажмите кнопку **"Настройки печати"**
3. Выберите нужный формат (PDF или Excel)
4. Нажмите **"Сохранить"**

### Создание шаблонов

1. В диалоге настроек печати нажмите **"Создать шаблоны печатных форм"**
2. Подтвердите создание
3. Шаблоны будут созданы в папке `PrnForms`
4. Откройте шаблоны в Excel и настройте их по своему усмотрению

### Использование плейсхолдеров в шаблонах

В шаблонах можно использовать следующие плейсхолдеры:

#### Для сметы (estimate_template.xlsx):
- `{NUMBER}` - номер сметы
- `{DATE}` - дата сметы
- `{OBJECT}` - наименование объекта
- `{CUSTOMER}` - заказчик
- `{CONTRACTOR}` - подрядчик
- `{TOTAL_SUM}` - итоговая сумма
- `{TOTAL_LABOR}` - итоговые трудозатраты

#### Для ежедневного отчета (daily_report_template.xlsx):
- `{DATE}` - дата отчета
- `{ESTIMATE_NUMBER}` - номер сметы
- `{ESTIMATE_DATE}` - дата сметы
- `{OBJECT}` - объект
- `{FOREMAN}` - бригадир

### Печать документов

1. Откройте документ (смету или ежедневный отчет)
2. Нажмите кнопку **"Печать"** (Ctrl+P)
3. Документ будет сгенерирован в выбранном формате и открыт в соответствующем приложении

## Структура шаблонов

### Шаблон сметы

Шаблон должен содержать:
- Заголовок с реквизитами
- Таблицу с колонками:
  - N - номер строки
  - Код - код работы
  - Наименование работ и затрат
  - ЕдИзм - единица измерения
  - Кол-во - количество
  - Зарплата (на единицу)
  - Материалы, механизмы (на единицу)
  - Всего (на единицу)
  - ТЗ (на единицу)
  - Зарплата (на полный объём)
  - Материалы, механизмы (на полный объём)
  - Всего (на полный объём)
  - ТЗ (на полный объём)
- Итоговую секцию

### Шаблон ежедневного отчета

Шаблон должен содержать:
- Заголовок с реквизитами
- Таблицу с колонками:
  - № п/п
  - Наименование выполненных работ
  - Ед. изм.
  - Объем работ
  - Плановые трудозатраты, ч
  - Фактические трудозатраты, ч
  - Отклонение, %
  - Исполнители (ФИО)
- Итоговую секцию
- Подписи

## Конфигурация

Настройки хранятся в файле `env.ini`:

```ini
[PrintForms]
# Формат печатных форм: PDF или Excel
format=PDF
# Путь к шаблонам печатных форм (относительно папки программы)
templates_path=PrnForms
```

## Технические детали

### Файлы

- `src/services/excel_print_form_generator.py` - базовый класс для генерации Excel форм
- `src/services/excel_estimate_print_form.py` - генератор сметы в Excel
- `src/services/excel_daily_report_print_form.py` - генератор ежедневного отчета в Excel
- `src/services/print_form_service.py` - сервис управления печатными формами
- `src/views/print_settings_dialog.py` - диалог настроек печати

### Зависимости

- `openpyxl` - библиотека для работы с Excel файлами (уже включена в requirements.txt)

## Преимущества Excel формата

1. **Редактирование** - возможность редактировать данные после генерации
2. **Расчеты** - можно добавить формулы Excel
3. **Интеграция** - легко импортировать в другие системы
4. **Гибкость** - полная настройка внешнего вида через шаблоны
5. **Совместимость** - открывается в Excel, LibreOffice, Google Sheets

## Примечания

- При первом использовании Excel формата рекомендуется создать шаблоны
- Шаблоны можно редактировать в любое время
- Изменения в шаблонах применяются сразу при следующей печати
- Если шаблон поврежден, удалите его - программа создаст документ автоматически
