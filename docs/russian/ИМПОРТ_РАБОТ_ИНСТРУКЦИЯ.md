# Инструкция по импорту работ из CSV

## Описание

Инструмент для импорта списка работ (наименование, цена, единица измерения) из CSV файла в базу данных.

Доступны два способа импорта:
1. **Через веб-интерфейс** (рекомендуется) - удобный графический интерфейс
2. **Через командную строку** - для автоматизации и массового импорта

## Формат CSV файла

CSV файл должен содержать следующие колонки (разделитель - точка с запятой):

- **Тип работ** - категория/группа работ (необязательно)
- **Наименование работы** - название работы
- **Цена** - стоимость работы
- **Единица измерения** - единица измерения (руб., руб/м2, руб/пог.м и т.д.)

### Пример CSV:

```csv
Тип работ;Наименование работы;Цена;Единица измерения
Электромонтажные работы;монтаж розетки (220 В);500;руб.
Электромонтажные работы;монтаж выключателя (220 В);500;руб.
Сантехнические работы;установка унитаза, без демонтажа;1500;руб.
```

## Использование

### Способ 1: Через веб-интерфейс (рекомендуется)

1. Откройте веб-интерфейс системы
2. Перейдите в **Справочники** → **Работы**
3. Нажмите кнопку **"Импорт CSV"** в правом верхнем углу
4. Выберите CSV файл
5. (Опционально) Выберите родительскую группу для импорта
6. Нажмите **"Импортировать"**

Подробная инструкция: [ИМПОРТ_РАБОТ_ВЕБ.md](ИМПОРТ_РАБОТ_ВЕБ.md)

### Способ 2: Через командную строку

#### Вариант 1: Через batch-файл

```cmd
import_works.bat умелец.csv
```

Для обновления существующих работ:

```cmd
import_works.bat умелец.csv --update
```

#### Вариант 2: Напрямую через Python

```cmd
python import_works_from_csv.py умелец.csv
```

С обновлением существующих:

```cmd
python import_works_from_csv.py умелец.csv --update
```

## Параметры

- **csv_file** - путь к CSV файлу (обязательный)
- **--update** - обновлять существующие работы вместо пропуска (необязательный)

## Логика работы

1. **Группировка работ**: Если указан "Тип работ", создается группа (родительская запись), и работы добавляются как дочерние элементы

2. **Обработка существующих работ**:
   - По умолчанию: существующие работы пропускаются
   - С флагом `--update`: существующие работы обновляются

3. **Парсинг данных**:
   - Цена: извлекаются только цифры (например, "500 руб." → 500)
   - Единица измерения: убирается "руб." и "руб/" (например, "руб/м2" → "м2")

## Результат

После выполнения импорта выводится:
- Количество добавленных работ
- Количество пропущенных работ
- Список ошибок (если есть)

## Пример вывода

```
Импорт работ из файла: умелец.csv
------------------------------------------------------------

Результаты импорта:
  Добавлено работ: 185
  Пропущено работ: 0

Импорт завершен успешно!
```

## Просмотр импортированных работ

Для просмотра импортированных работ используйте:

### Просмотр всех групп:

```cmd
view_works.bat
```

или

```cmd
python view_works.py
```

### Просмотр работ конкретной группы:

```cmd
view_works.bat "Электромонтажные работы"
```

или

```cmd
python view_works.py --group "Электромонтажные работы"
```

## Очистка дубликатов

Если при повторном импорте с флагом `--update` появились дубликаты, их можно удалить:

### Просмотр дубликатов (без удаления):

```cmd
python clean_duplicate_works.py
```

### Удаление дубликатов:

```cmd
python clean_duplicate_works.py --delete
```

Скрипт оставляет самую раннюю запись и удаляет все дубликаты.

## Примечания

- Файл `умелец.csv` включен в проект как пример
- Работы автоматически группируются по типу
- Пустые наименования работ пропускаются
- Кодировка файла должна быть UTF-8
- При использовании флага `--update` существующие работы будут обновлены (может создать дубликаты, если структура изменилась)
- Рекомендуется использовать импорт без флага `--update` для избежания дубликатов
