# Функционал удаления помеченных элементов

## Описание

Добавлен функционал для работы с помеченными на удаление элементами в справочниках.

## Возможности

### 1. Пометка элементов на удаление

- **Групповая пометка**: Выберите несколько элементов в таблице и нажмите кнопку "Пометить на удаление"
- **Импорт CSV в режиме удаления**: При импорте CSV можно включить режим удаления, который пометит все работы с указанными наименованиями

### 2. Физическое удаление помеченных элементов

- Кнопка **"Удалить помеченные"** появляется в заголовке таблицы, когда есть помеченные элементы
- При нажатии удаляет ВСЕ помеченные элементы НАВСЕГДА (необратимо)
- Требует подтверждения администратора

### 3. Режим удаления в импорте CSV

В модальном окне импорта CSV добавлен чекбокс **"Режим удаления"**:
- При включении этого режима файл CSV используется для пометки работ на удаление по наименованиям
- Автоматически отключает опцию "Пропускать существующие работы"
- Полезно для массовой очистки справочника

## API Endpoints

### Пометка на удаление (существующие)
- `POST /api/references/works/bulk-delete` - пометить работы
- `POST /api/references/counterparties/bulk-delete` - пометить контрагентов
- `POST /api/references/objects/bulk-delete` - пометить объекты
- `POST /api/references/persons/bulk-delete` - пометить лиц
- `POST /api/references/organizations/bulk-delete` - пометить организации

### Физическое удаление (новые)
- `DELETE /api/references/works/permanent-delete-marked` - удалить помеченные работы
- `DELETE /api/references/counterparties/permanent-delete-marked` - удалить помеченных контрагентов
- `DELETE /api/references/objects/permanent-delete-marked` - удалить помеченные объекты
- `DELETE /api/references/persons/permanent-delete-marked` - удалить помеченных лиц
- `DELETE /api/references/organizations/permanent-delete-marked` - удалить помеченные организации

### Импорт с режимом удаления
- `POST /api/references/works/import-csv?delete_mode=true` - импорт CSV в режиме удаления

## Использование

### Пометка элементов через UI

1. Откройте справочник (например, "Работы")
2. Выберите элементы, которые нужно пометить на удаление
3. Нажмите кнопку "Пометить на удаление (N)"
4. Подтвердите действие

### Удаление помеченных элементов

1. В заголовке таблицы появится красная кнопка "Удалить помеченные"
2. Нажмите на неё
3. Подтвердите необратимое удаление
4. Все помеченные элементы будут удалены из базы данных

### Импорт CSV в режиме удаления

1. Нажмите кнопку "Импорт CSV"
2. Выберите CSV файл с наименованиями работ для удаления
3. Включите чекбокс "Режим удаления"
4. Нажмите "Импортировать"
5. Все работы с указанными наименованиями будут помечены на удаление

## Формат CSV для режима удаления

```csv
Тип работ;Наименование работы;Цена;Единица измерения
;Работа 1;;
;Работа 2;;
;Работа 3;;
```

В режиме удаления используется только колонка "Наименование работы", остальные игнорируются.

## Безопасность

- Физическое удаление доступно только администраторам
- Требуется двойное подтверждение
- Действие необратимо - восстановление возможно только из резервной копии БД

## Изменённые файлы

### Backend
- `api/endpoints/references.py` - добавлены endpoints для физического удаления

### Frontend
- `web-client/src/api/references.ts` - добавлены методы API клиента
- `web-client/src/views/references/WorksView.vue` - добавлен UI для удаления помеченных элементов

## Примечания

- Помеченные элементы отображаются в таблице с красным индикатором
- Фильтр "Удаленные" позволяет показать только помеченные или только активные элементы
- Физическое удаление удаляет элементы из базы данных без возможности восстановления
