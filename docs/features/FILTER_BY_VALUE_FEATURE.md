# Фильтрация по значению в формах списков документов

## Описание

Добавлена расширенная фильтрация по значениям в формах списков документов (Сметы и Ежедневные отчеты). Теперь пользователи могут фильтровать документы не только по тексту и статусу проведения, но и по конкретным значениям в связанных справочниках.

## Реализованные фильтры

### Форма списка смет (EstimateListForm)

**Первая строка фильтров:**
- **Поиск (Ctrl+F)** - текстовый поиск по номеру, заказчику, объекту
- **Статус** - фильтр по статусу проведения (Все / Проведенные / Не проведенные)

**Вторая строка фильтров:**
- **Заказчик** - выпадающий список всех заказчиков, у которых есть сметы
- **Объект** - выпадающий список всех объектов, по которым есть сметы
- **Ответственный** - выпадающий список всех ответственных лиц
- **Очистить фильтры** - кнопка для сброса всех фильтров

### Форма списка ежедневных отчетов (DailyReportListForm)

**Первая строка фильтров:**
- **Поиск (Ctrl+F)** - текстовый поиск по номеру сметы, ФИО бригадира
- **Статус** - фильтр по статусу проведения (Все / Проведенные / Не проведенные)

**Вторая строка фильтров:**
- **Смета** - выпадающий список всех смет, по которым есть отчеты
- **Бригадир** - выпадающий список всех бригадиров
- **Очистить фильтры** - кнопка для сброса всех фильтров

## Особенности реализации

### Динамическая загрузка значений

Выпадающие списки фильтров загружаются динамически из базы данных и содержат только те значения, которые реально используются в документах:

```python
def load_customers(self):
    """Load customers for filter"""
    cursor = self.db.cursor()
    cursor.execute("""
        SELECT DISTINCT c.id, c.name
        FROM counterparties c
        INNER JOIN estimates e ON e.customer_id = c.id
        WHERE c.marked_for_deletion = 0
        ORDER BY c.name
    """)
    for row in cursor.fetchall():
        self.customer_filter.addItem(row['name'], row['id'])
```

### Комбинирование фильтров

Все фильтры работают совместно - можно одновременно применить:
- Текстовый поиск
- Фильтр по статусу
- Фильтры по справочникам

Например: найти все непроведенные сметы для заказчика "ООО Рога и Копыта" по объекту "Торговый центр".

### SQL запросы с WHERE

Фильтры реализованы через динамическое построение WHERE условий:

```python
where_clauses = ["(e.marked_for_deletion = 0 OR e.marked_for_deletion IS NULL)"]
params = []

if search_text:
    where_clauses.append("(e.number LIKE ? OR c.name LIKE ? OR o.name LIKE ?)")
    params.extend([f"%{search_text}%", f"%{search_text}%", f"%{search_text}%"])

if customer_id is not None:
    where_clauses.append("e.customer_id = ?")
    params.append(customer_id)

where_clause = " AND ".join(where_clauses)
```

## Использование

### Фильтрация смет

1. Откройте форму "Документы: Сметы"
2. Выберите нужные фильтры:
   - Введите текст для поиска (опционально)
   - Выберите статус проведения (опционально)
   - Выберите заказчика из списка (опционально)
   - Выберите объект из списка (опционально)
   - Выберите ответственного из списка (опционально)
3. Список автоматически обновится
4. Для сброса всех фильтров нажмите "Очистить фильтры"

### Фильтрация ежедневных отчетов

1. Откройте форму "Документы: Ежедневные отчеты"
2. Выберите нужные фильтры:
   - Введите текст для поиска (опционально)
   - Выберите статус проведения (опционально)
   - Выберите смету из списка (опционально)
   - Выберите бригадира из списка (опционально)
3. Список автоматически обновится
4. Для сброса всех фильтров нажмите "Очистить фильтры"

## Примеры использования

### Пример 1: Найти все сметы для конкретного заказчика

1. В форме списка смет выберите заказчика из выпадающего списка "Заказчик"
2. Список покажет только сметы этого заказчика

### Пример 2: Найти непроведенные отчеты конкретного бригадира

1. В форме списка отчетов выберите "Не проведенные" в фильтре "Статус"
2. Выберите бригадира из выпадающего списка "Бригадир"
3. Список покажет только непроведенные отчеты этого бригадира

### Пример 3: Найти все сметы по объекту с текстом в номере

1. Введите часть номера в поле "Поиск"
2. Выберите объект из выпадающего списка "Объект"
3. Список покажет только сметы по этому объекту, содержащие указанный текст

### Пример 4: Найти все отчеты по конкретной смете

1. В форме списка отчетов выберите смету из выпадающего списка "Смета"
2. Список покажет все отчеты по этой смете

## Технические детали

### Измененные файлы

- `src/views/estimate_list_form.py` - добавлены фильтры по заказчику, объекту, ответственному
- `src/views/daily_report_list_form.py` - добавлены фильтры по смете, бригадиру

### Новые методы

**EstimateListForm:**
- `load_customers()` - загрузка списка заказчиков
- `load_objects()` - загрузка списка объектов
- `load_responsibles()` - загрузка списка ответственных
- `on_clear_filters()` - очистка всех фильтров

**DailyReportListForm:**
- `load_estimates()` - загрузка списка смет
- `load_foremen()` - загрузка списка бригадиров
- `on_clear_filters()` - очистка всех фильтров

### Обновленные методы

- `load_data()` - добавлена обработка новых фильтров
- `setup_ui()` - добавлена вторая строка с фильтрами

## Преимущества

1. **Быстрый поиск** - не нужно прокручивать длинный список документов
2. **Комбинирование условий** - можно применить несколько фильтров одновременно
3. **Удобство** - выпадающие списки показывают только реально используемые значения
4. **Производительность** - фильтрация выполняется на уровне SQL запроса
5. **Интуитивность** - понятный интерфейс с подписями фильтров

## Будущие улучшения

- [ ] Добавить фильтр по диапазону дат
- [ ] Добавить фильтр по диапазону сумм
- [ ] Сохранение последних использованных фильтров
- [ ] Экспорт отфильтрованного списка в Excel
- [ ] Быстрые фильтры (предустановленные комбинации)
- [ ] Фильтр по нескольким значениям одновременно (множественный выбор)
