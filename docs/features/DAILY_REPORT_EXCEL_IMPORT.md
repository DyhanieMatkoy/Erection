# Импорт ежедневного отчета из Excel

## Описание

Добавлена возможность импорта ежедневных отчетов из Excel файлов, аналогично существующему импорту смет. Функциональность позволяет быстро создавать ежедневные отчеты на основе данных из Excel документов.

## Функциональность

### Десктопное приложение

#### Форма ежедневного отчета
- Кнопка "Загрузить из Excel" в табличной части
- Автоматическое заполнение полей из Excel файла
- Поиск работ по коду в справочнике
- Отображение ненайденных работ как пустых ссылок

#### Поддерживаемые данные
- **Дата отчета** - извлекается из заголовка документа
- **Смета** - поиск по номеру в справочнике
- **Бригадир** - поиск по ФИО в справочнике персон
- **Работы** - поиск по коду или наименованию
- **Фактические трудозатраты** - числовое значение количества

### Веб-клиент

#### Список ежедневных отчетов
- Кнопка "Импорт из Excel" в заголовке списка
- Автоматическое открытие импортированного отчета
- Уведомления об успешном импорте

## Структура Excel файла

### Заголовочная часть (строки 1-15)
Система ищет следующую информацию:

```
Смета №123-2024          -> номер сметы для поиска в справочнике
Бригадир: Иванов И.И.    -> ФИО бригадира для поиска в справочнике
Дата: 15.12.2024         -> дата отчета
```

### Табличная часть (строки 15-30)
Поиск заголовка таблицы с колонками:
- **Наименование работ** или **Код** - для идентификации работ
- **Количество** или **Объем** или **Факт** - фактические трудозатраты

### Данные работ
Каждая строка содержит:
- Код или наименование работы (для поиска в справочнике)
- Количество фактических трудозатрат

## Алгоритм импорта

### 1. Парсинг заголовка
- Извлечение номера сметы и поиск в справочнике
- Извлечение ФИО бригадира и поиск/создание в справочнике персон
- Извлечение даты отчета

### 2. Поиск табличной части
- Автоматическое определение строки заголовка
- Определение колонок с работами и количеством

### 3. Обработка строк работ
- Поиск работы по коду (приоритет)
- Поиск работы по наименованию (частичное совпадение)
- Создание строки с пустой ссылкой если работа не найдена
- Расчет отклонений от плановых трудозатрат (если есть смета)

### 4. Создание документа
- Генерация номера отчета
- Сохранение в базу данных
- Возврат созданного документа

## Технические детали

### Новые файлы

#### Backend (Python)
```
src/services/excel_daily_report_import_service.py
```
- `ExcelDailyReportImportService` - основной сервис импорта
- Методы парсинга Excel файлов
- Поиск и создание справочных данных

#### API Endpoint
```
POST /documents/daily-reports/import-excel
```
- Загрузка Excel файла
- Валидация формата
- Импорт и сохранение данных

#### Frontend (TypeScript/Vue)
```
web-client/src/api/documents.ts
```
- `importDailyReportFromExcel()` - API функция

### Изменения в существующих файлах

#### Форма ежедневного отчета
```python
src/views/daily_report_document_form.py
```
- Добавлена кнопка "Загрузить из Excel"
- Метод `on_import_from_excel()`
- Обновление состояния кнопки при проведении

#### Список ежедневных отчетов
```vue
web-client/src/views/documents/DailyReportListView.vue
```
- Кнопка "Импорт из Excel"
- Обработчики `handleImportExcel()` и `handleFileSelected()`

## Использование

### Десктопное приложение

1. Откройте форму ежедневного отчета (новый или существующий)
2. Нажмите кнопку "Загрузить из Excel" в табличной части
3. Выберите Excel файл с данными отчета
4. Система автоматически заполнит поля и табличную часть
5. Проверьте и отредактируйте данные при необходимости
6. Сохраните отчет

### Веб-клиент

1. Перейдите в список ежедневных отчетов
2. Нажмите кнопку "Импорт из Excel"
3. Выберите Excel файл
4. Система создаст новый отчет и откроет его для редактирования

## Обработка ошибок

### Валидация файла
- Проверка расширения (.xlsx, .xls)
- Проверка структуры Excel файла

### Обработка данных
- Ненайденные работы отображаются как пустые ссылки
- Ненайденные сметы - поле остается пустым
- Ненайденные бригадиры - создаются автоматически

### Уведомления пользователя
- Сообщение об успешном импорте с количеством строк
- Предупреждение о ненайденных ссылках
- Детальные сообщения об ошибках

## Примеры использования

### Типичный сценарий
1. Бригадир заполняет Excel шаблон с фактическими объемами работ
2. Файл загружается через систему
3. Система автоматически создает ежедневный отчет
4. Ответственный проверяет и проводит документ

### Интеграция с существующими процессами
- Импортированные отчеты участвуют в расчете табелей
- Данные попадают в регистр выполнения работ
- Возможность печати и экспорта как обычных отчетов

## Ограничения

- Поддерживаются только форматы .xlsx и .xls
- Максимальный размер файла ограничен настройками сервера
- Структура Excel файла должна соответствовать ожидаемому формату
- Работы ищутся только в активных (не помеченных на удаление) записях

## Совместимость

- Совместимо с существующей структурой базы данных
- Не требует изменений в других модулях системы
- Работает как в десктопной, так и в веб-версии
- Поддерживает все существующие функции ежедневных отчетов