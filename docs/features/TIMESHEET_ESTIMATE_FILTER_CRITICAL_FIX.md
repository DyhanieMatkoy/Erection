# –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –û—à–∏–±–∫–∞ 422 –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–º–µ—Ç

## üö® –ü—Ä–æ–±–ª–µ–º–∞

**–°—Ç–∞—Ç—É—Å:** –ö–†–ò–¢–ò–ß–ù–û - –í–µ–±-–≤–µ—Ä—Å–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –≤–µ–±-–≤–µ—Ä—Å–∏–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å–º–µ—Ç—ã –≤ —Ñ–æ—Ä–º–µ —Ç–∞–±–µ–ª—è
- Desktop –≤–µ—Ä—Å–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –æ—à–∏–±–∫–∞ 422

**HTTP –û—à–∏–±–∫–∞:**
```
Request:  /api/documents/estimates?page=1&page_size=10000
Response: 422 Unprocessable Entity

{
  "detail": [{
    "type": "less_than_equal",
    "loc": ["query", "page_size"],
    "msg": "Input should be less than or equal to 100",
    "input": "10000",
    "ctx": {"le": 100}
  }]
}
```

## üîç –ü—Ä–∏—á–∏–Ω–∞

### Backend –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ (api/endpoints/documents.py, —Å—Ç—Ä–æ–∫–∞ 95):
```python
@router.get("/documents/estimates")
async def list_estimates(
    page: int = Query(1, ge=1),
    page_size: int = Query(50, ge=1, le=100),  # ‚Üê –ú–∞–∫—Å–∏–º—É–º 100!
    ...
):
```

### Frontend –∑–∞–ø—Ä–æ—Å (web-client/src/views/documents/TimesheetFormView.vue):
```typescript
const response = await documentsApi.getEstimates({ 
  page: 1, 
  page_size: 10000  // ‚Üê –ü—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç!
})
```

### –ü–æ—á–µ–º—É Desktop —Ä–∞–±–æ—Ç–∞–µ—Ç?

Desktop –≤–µ—Ä—Å–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ SQLite** –±–µ–∑ API, –ø–æ—ç—Ç–æ–º—É –Ω–µ –ø–æ–¥–≤–µ—Ä–∂–µ–Ω–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º FastAPI.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–ù–ï —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ò–∑–º–µ–Ω–∏—Ç—å `page_size` –Ω–∞ 100:
```typescript
const response = await documentsApi.getEstimates({ page: 1, page_size: 100 })
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞–≥—Ä—É–∑—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 100 —Å–º–µ—Ç. –ï—Å–ª–∏ —Å–º–µ—Ç –±–æ–ª—å—à–µ, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–µ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã.

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (–†–ï–ê–õ–ò–ó–û–í–ê–ù–û) ‚úÖ

–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ —Å–º–µ—Ç—ã —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π:

```typescript
// Load ALL estimates with pagination
try {
  const allEstimates = []
  let page = 1
  let hasMore = true
  
  while (hasMore) {
    const response = await documentsApi.getEstimates({ page, page_size: 100 })
    allEstimates.push(...response.data)
    
    // Check if there are more pages
    hasMore = response.pagination && page < response.pagination.total_pages
    page++
  }
  
  estimatesData.value = allEstimates.filter((e) => !e.marked_for_deletion)
  console.log(`Loaded ${estimatesData.value.length} estimates`)
} catch (error) {
  console.error('Failed to load estimates:', error)
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –í–°–ï —Å–º–µ—Ç—ã, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
- ‚úÖ –°–æ–±–ª—é–¥–∞–µ—Ç—Å—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ API (page_size ‚â§ 100)
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å–º–µ—Ç

## üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è

### –§–∞–π–ª: `web-client/src/views/documents/TimesheetFormView.vue`

**–°—Ç—Ä–æ–∫–∏:** ~407-413

**–ë—ã–ª–æ:**
```typescript
// Load ALL estimates (no filtering)
try {
  const response = await documentsApi.getEstimates({ page: 1, page_size: 10000 })
  estimatesData.value = response.data.filter((e) => !e.marked_for_deletion)
  console.log(`Loaded ${estimatesData.value.length} estimates`)
} catch (error) {
  console.error('Failed to load estimates:', error)
}
```

**–°—Ç–∞–ª–æ:**
```typescript
// Load ALL estimates with pagination
try {
  const allEstimates = []
  let page = 1
  let hasMore = true
  
  while (hasMore) {
    const response = await documentsApi.getEstimates({ page, page_size: 100 })
    allEstimates.push(...response.data)
    
    // Check if there are more pages
    hasMore = response.pagination && page < response.pagination.total_pages
    page++
  }
  
  estimatesData.value = allEstimates.filter((e) => !e.marked_for_deletion)
  console.log(`Loaded ${estimatesData.value.length} estimates`)
} catch (error) {
  console.error('Failed to load estimates:', error)
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
‚ùå GET /api/documents/estimates?page=1&page_size=10000 ‚Üí 422
‚ùå Failed to load estimates: Error...
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
‚úÖ GET /api/documents/estimates?page=1&page_size=100 ‚Üí 200
‚úÖ GET /api/documents/estimates?page=2&page_size=100 ‚Üí 200 (–µ—Å–ª–∏ –µ—Å—Ç—å)
‚úÖ Loaded 8 estimates
```

### –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

#### –¢–µ—Å—Ç 1: –ú–∞–ª–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–º–µ—Ç (< 100)
1. –ë–∞–∑–∞ —Å 8 —Å–º–µ—Ç–∞–º–∏
2. –û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É —Ç–∞–±–µ–ª—è
3. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - 1 –∑–∞–ø—Ä–æ—Å –∫ API (page=1)
   - –ó–∞–≥—Ä—É–∂–µ–Ω–æ 8 —Å–º–µ—Ç
   - –ù–µ—Ç –æ—à–∏–±–æ–∫ 422

#### –¢–µ—Å—Ç 2: –°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–º–µ—Ç (100-200)
1. –ë–∞–∑–∞ —Å–æ 150 —Å–º–µ—Ç–∞–º–∏
2. –û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É —Ç–∞–±–µ–ª—è
3. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - 2 –∑–∞–ø—Ä–æ—Å–∞ –∫ API (page=1, page=2)
   - –ó–∞–≥—Ä—É–∂–µ–Ω–æ 150 —Å–º–µ—Ç
   - –ù–µ—Ç –æ—à–∏–±–æ–∫ 422

#### –¢–µ—Å—Ç 3: –ë–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–º–µ—Ç (> 200)
1. –ë–∞–∑–∞ —Å 350 —Å–º–µ—Ç–∞–º–∏
2. –û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É —Ç–∞–±–µ–ª—è
3. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - 4 –∑–∞–ø—Ä–æ—Å–∞ –∫ API (page=1,2,3,4)
   - –ó–∞–≥—Ä—É–∂–µ–Ω–æ 350 —Å–º–µ—Ç
   - –ù–µ—Ç –æ—à–∏–±–æ–∫ 422

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ:

| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–º–µ—Ç | –ó–∞–ø—Ä–æ—Å–æ–≤ –∫ API | –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ | –¢—Ä–∞—Ñ–∏–∫ |
|----------------|----------------|----------------|--------|
| 8 (—Ç–µ–∫—É—â–∞—è –ë–î) | 1 | ~100ms | ~2KB |
| 100 | 1 | ~150ms | ~20KB |
| 200 | 2 | ~300ms | ~40KB |
| 500 | 5 | ~750ms | ~100KB |

**–í—ã–≤–æ–¥:** –î–ª—è —Ç–µ–∫—É—â–µ–π –±–∞–∑—ã (8 —Å–º–µ—Ç) –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è.

## üîÑ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 3: –£–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç –Ω–∞ –±—ç–∫–µ–Ω–¥–µ

**–ò–∑–º–µ–Ω–∏—Ç—å –≤ `api/endpoints/documents.py`:**
```python
page_size: int = Query(50, ge=1, le=1000),  # –£–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 1000
```

**–ü–ª—é—Å—ã:**
- –ú–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API
- –ü—Ä–æ—â–µ –∫–æ–¥ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø—Ä–æ–±–ª–µ–º–∞–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚ùå –ë–æ–ª—å—à–∏–µ –æ—Ç–≤–µ—Ç—ã –æ—Ç API
- ‚ùå –ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç best practices REST API

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –í–∞—Ä–∏–∞–Ω—Ç 4: –°–µ—Ä–≤–µ—Ä–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è (–±—É–¥—É—â–µ–µ —É–ª—É—á—à–µ–Ω–∏–µ)

–ó–∞–≥—Ä—É–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–º–µ—Ç—ã –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞:

```typescript
async function handleObjectChange() {
  formData.value.estimate_id = 0
  if (formData.value.object_id) {
    await loadEstimatesForObject(formData.value.object_id)
  }
}

async function loadEstimatesForObject(objectId: number) {
  try {
    const response = await documentsApi.getEstimates({ 
      page: 1, 
      page_size: 100,
      object_id: objectId  // –°–µ—Ä–≤–µ—Ä–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
    })
    estimatesData.value = response.data.filter((e) => !e.marked_for_deletion)
  } catch (error) {
    console.error('Failed to load estimates:', error)
  }
}
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ç—Ä–∞—Ñ–∏–∫
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

**–ú–∏–Ω—É—Å—ã:**
- –¢—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ
- –ù—É–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–º–µ–Ω—É –æ–±—ä–µ–∫—Ç–∞

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏

## üìã –ß–µ–∫-–ª–∏—Å—Ç

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞:
- [x] –ö–æ–¥ –∏–∑–º–µ–Ω–µ–Ω
- [x] –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏—è
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –≤–µ–±-–≤–µ—Ä—Å–∏–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å –º–∞–ª—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å–º–µ—Ç
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (–Ω–µ—Ç –æ—à–∏–±–æ–∫ 422)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Network tab (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –æ–±—ä–µ–∫—Ç–∞–º

### –†–µ–≥—Ä–µ—Å—Å–∏—è:
- [ ] Desktop –≤–µ—Ä—Å–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–µ–ª—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–µ–ª—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–º–µ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç

## üöÄ –î–µ–ø–ª–æ–π

### –®–∞–≥–∏:
1. ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤–Ω–µ—Å–µ–Ω—ã –≤ –∫–æ–¥
2. ‚è≥ –°–æ–±—Ä–∞—Ç—å –≤–µ–±-–∫–ª–∏–µ–Ω—Ç: `npm run build`
3. ‚è≥ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–µ–±-—Å–µ—Ä–≤–µ—Ä
4. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ

### –ö–æ–º–∞–Ω–¥—ã:
```bash
# –í –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ web-client
npm run build

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å API (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
# Desktop –≤–µ—Ä—Å–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
```

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- **TIMESHEET_ESTIMATE_FILTER_ANALYSIS.md** - –ê–Ω–∞–ª–∏–∑ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- **TIMESHEET_ESTIMATE_FILTER_FIX.md** - –û—Å–Ω–æ–≤–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- **TIMESHEET_ESTIMATE_FILTER_INDEX.md** - –ù–∞–≤–∏–≥–∞—Ü–∏—è

## üéØ –ò—Ç–æ–≥

### –ü—Ä–æ–±–ª–µ–º–∞:
‚ùå –í–µ–±-–≤–µ—Ä—Å–∏—è –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–º–µ—Ç—ã –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏ 422 (page_size > 100)

### –†–µ—à–µ–Ω–∏–µ:
‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Å–º–µ—Ç –ø–æ—Ä—Ü–∏—è–º–∏ –ø–æ 100

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –í–µ–±-–≤–µ—Ä—Å–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤—Å–µ —Å–º–µ—Ç—ã
- ‚úÖ –°–æ–±–ª—é–¥–∞—é—Ç—Å—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è API
- ‚úÖ Desktop –≤–µ—Ä—Å–∏—è –Ω–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç–∞

---

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
**–î–∞—Ç–∞:** 2025-11-30
**–í–µ—Ä—Å–∏—è:** 1.0
