# Функциональность групп в справочниках

## Обзор

В систему добавлена поддержка иерархической организации элементов справочников через группы. Это позволяет структурировать данные и упростить навигацию в больших справочниках.

## Поддерживаемые справочники

Функциональность групп реализована для следующих справочников:
- Объекты (Objects)
- Физические лица (Persons)
- Работы (Works)
- Контрагенты (Counterparties)
- Организации (Organizations)

## Возможности

### Создание групп

В каждой форме списка справочника доступны две кнопки:
- **"Создать (Insert/F9)"** - создание нового элемента справочника
- **"Создать группу"** - создание новой группы для организации элементов

### Иерархическая структура

Каждый элемент справочника может:
- Быть обычным элементом (is_group=false)
- Быть группой (is_group=true)
- Иметь родительский элемент или группу (parent_id)

### Выбор родителя

При создании или редактировании элемента доступно поле "Родитель":
- Кнопка "..." - открывает диалог выбора родительского элемента
- Кнопка "✕" - очищает выбранного родителя
- Система автоматически проверяет отсутствие циклических ссылок

## Структура базы данных

Для каждого справочника добавлены поля:
- `parent_id` - ссылка на родительский элемент (может быть NULL)
- `is_group` - признак группы (0 - обычный элемент, 1 - группа)

## Использование

### Создание группы

1. Откройте форму списка справочника
2. Нажмите кнопку "Создать группу"
3. Заполните наименование группы
4. При необходимости выберите родительскую группу
5. Сохраните

### Создание элемента в группе

1. Откройте форму списка справочника
2. Нажмите кнопку "Создать (Insert/F9)"
3. Заполните реквизиты элемента
4. В поле "Родитель" выберите группу, к которой должен принадлежать элемент
5. Сохраните

### Перемещение элемента между группами

1. Откройте форму элемента справочника
2. В поле "Родитель" выберите новую группу или очистите поле
3. Сохраните изменения

## Технические детали

### Миграция базы данных

При первом запуске приложения после обновления автоматически выполняется миграция:
- Добавляются поля `parent_id` и `is_group` во все таблицы справочников
- Существующие данные сохраняются без изменений
- Для всех существующих элементов `is_group=0` и `parent_id=NULL`

### Проверка циклических ссылок

При выборе родителя система проверяет:
- Элемент не может быть родителем самого себя
- Предотвращаются циклические ссылки в иерархии

## Примеры использования

### Организация работ по разделам

```
Работы
├── Земляные работы (группа)
│   ├── Разработка грунта
│   └── Обратная засыпка
├── Бетонные работы (группа)
│   ├── Устройство фундамента
│   └── Заливка перекрытий
└── Отделочные работы (группа)
    ├── Штукатурка
    └── Покраска
```

### Организация объектов по заказчикам

```
Объекты
├── ООО "Строй+" (группа)
│   ├── Жилой комплекс "Северный"
│   └── Торговый центр "Южный"
└── ИП Иванов (группа)
    └── Коттедж на ул. Лесной
```

## Будущие улучшения

Планируется добавить:
- Визуальное отображение иерархии в формах списков (древовидная структура)
- Фильтрация по группам
- Массовое перемещение элементов между группами
- Сворачивание/разворачивание групп в списках
