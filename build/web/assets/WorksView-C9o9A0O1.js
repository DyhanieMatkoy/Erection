import{d as c,h as x,c as g,w as n,a as l,b as r,i,u as t,n as v,t as s,j as m,e as _,k as h,o as d}from"./index-6EFolkGo.js";import{u as k}from"./useReferenceView-CoO5t6qc.js";import{u as y,_ as u,j as C,k as w,l as V,m as S}from"./FormField.vue_vue_type_script_setup_true_lang-BDJ46V17.js";import{_ as D}from"./AppLayout.vue_vue_type_script_setup_true_lang-fByiLTOw.js";import{_ as $}from"./DataTable.vue_vue_type_script_setup_true_lang-BaWuvIHH.js";import{_ as M}from"./Modal.vue_vue_type_script_setup_true_lang-DDauu2p3.js";import{_ as W}from"./Picker.vue_vue_type_script_setup_true_lang-T-Ajx66M.js";const j={class:"space-y-6"},B={key:0,class:"text-gray-500"},E={key:1,class:"text-gray-400"},N=["onClick"],P=["onClick"],R={key:0,class:"rounded-md bg-red-50 p-4"},I={class:"text-sm text-red-800"},U=["disabled"],K=c({__name:"WorksView",setup(z){const p=y(),e=k({getAll:S,create:V,update:w,delete:C},()=>p.fetchWorks(!0)),b=[{key:"id",label:"ID"},{key:"name",label:"Наименование"},{key:"unit",label:"Ед. изм."},{key:"parent_id",label:"Родитель"},{key:"is_deleted",label:"Статус"}];return x(()=>{e.loadData()}),(q,o)=>(d(),g(D,null,{default:n(()=>[l("div",j,[o[8]||(o[8]=l("div",null,[l("h2",{class:"text-2xl font-bold text-gray-900"},"Работы"),l("p",{class:"mt-1 text-sm text-gray-600"},"Управление справочником работ")],-1)),r($,{columns:b,data:t(e).table.data.value,loading:t(e).table.loading.value,pagination:t(e).table.pagination.value,onRowClick:t(e).handleEdit,onPageChange:t(e).handlePageChange,onSearch:t(e).handleSearch,onSort:t(e).handleSort},{"header-actions":n(()=>[l("button",{onClick:o[0]||(o[0]=(...a)=>t(e).handleCreate&&t(e).handleCreate(...a)),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700"},[...o[7]||(o[7]=[l("svg",{class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),_(" Создать ",-1)])])]),"cell-parent_id":n(({row:a})=>[a.parent_id?(d(),m("span",B,s(t(e).getParentName(a.parent_id)),1)):(d(),m("span",E,"—"))]),"cell-is_deleted":n(({value:a})=>[l("span",{class:v(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",a?"bg-red-100 text-red-800":"bg-green-100 text-green-800"])},s(a?"Удален":"Активен"),3)]),actions:n(({row:a})=>[l("button",{onClick:i(f=>t(e).handleEdit(a),["stop"]),class:"text-blue-600 hover:text-blue-900 mr-4"}," Изменить ",8,N),l("button",{onClick:i(f=>t(e).handleDelete(a),["stop"]),class:"text-red-600 hover:text-red-900"}," Удалить ",8,P)]),_:1},8,["data","loading","pagination","onRowClick","onPageChange","onSearch","onSort"]),r(M,{open:t(e).modalOpen.value,title:t(e).editingItem.value?"Редактирование работы":"Создание работы",size:"md",onClose:t(e).handleCloseModal},{footer:n(()=>[l("button",{onClick:o[5]||(o[5]=(...a)=>t(e).handleCloseModal&&t(e).handleCloseModal(...a)),type:"button",class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Отмена "),l("button",{onClick:o[6]||(o[6]=(...a)=>t(e).handleSubmit&&t(e).handleSubmit(...a)),type:"button",disabled:t(e).submitting.value,class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50"},s(t(e).submitting.value?"Сохранение...":"Сохранить"),9,U)]),default:n(()=>[l("form",{onSubmit:o[4]||(o[4]=i((...a)=>t(e).handleSubmit&&t(e).handleSubmit(...a),["prevent"])),class:"space-y-4"},[r(u,{modelValue:t(e).formData.value.name,"onUpdate:modelValue":o[1]||(o[1]=a=>t(e).formData.value.name=a),label:"Наименование",type:"text",required:"",error:t(e).errors.value.name},null,8,["modelValue","error"]),r(u,{modelValue:t(e).formData.value.unit,"onUpdate:modelValue":o[2]||(o[2]=a=>t(e).formData.value.unit=a),label:"Единица измерения",type:"text",error:t(e).errors.value.unit},null,8,["modelValue","error"]),r(W,{modelValue:t(e).formData.value.parent_id,"onUpdate:modelValue":o[3]||(o[3]=a=>t(e).formData.value.parent_id=a),label:"Родительский элемент",items:t(e).parentItems.value,error:t(e).errors.value.parent_id},null,8,["modelValue","items","error"]),t(e).submitError.value?(d(),m("div",R,[l("p",I,s(t(e).submitError.value),1)])):h("",!0)],32)]),_:1},8,["open","title","onClose"])])]),_:1}))}});export{K as default};
