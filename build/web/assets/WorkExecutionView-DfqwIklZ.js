const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/documents-D6jJUN3y.js","assets/index-6EFolkGo.js","assets/index-_K28hHdm.css"])))=>i.map(i=>d[i]);
import{C as S,d as U,f,m as L,j as u,k as R,a as t,t as r,F as C,p as E,i as M,l as W,o as d,g as $,h as z,_ as A,c as I,w as P,b as g,n as w}from"./index-6EFolkGo.js";import{u as T,_ as D}from"./FormField.vue_vue_type_script_setup_true_lang-BDJ46V17.js";import{_ as G}from"./AppLayout.vue_vue_type_script_setup_true_lang-fByiLTOw.js";import{_ as V}from"./Picker.vue_vue_type_script_setup_true_lang-T-Ajx66M.js";async function H(m){return(await S.get("/registers/work-execution",{params:m})).data}async function J(m){return(await S.get("/registers/work-execution/movements",{params:m})).data}const K={class:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0"},Q={class:"inline-block w-full max-w-5xl my-8 overflow-hidden text-left align-middle transition-all transform bg-white rounded-lg shadow-xl"},X={class:"px-6 py-4 bg-gray-50 border-b border-gray-200"},Y={class:"mt-1 text-sm text-gray-600"},Z={class:"px-6 py-4 max-h-[70vh] overflow-y-auto"},tt={key:0,class:"text-center py-8"},et={key:1},st={class:"min-w-full divide-y divide-gray-200"},at={class:"bg-white divide-y divide-gray-200"},it=["onDblclick"],rt={class:"px-4 py-3 text-sm text-gray-900"},lt={class:"px-4 py-3 text-sm text-blue-600 hover:text-blue-800"},ot={class:"px-4 py-3 text-sm text-gray-900"},nt={class:"px-4 py-3 text-sm text-right text-gray-900"},dt={class:"px-4 py-3 text-sm text-right text-gray-900"},ut={class:"px-4 py-3 text-sm text-right text-gray-900"},pt={class:"px-4 py-3 text-sm text-right text-gray-900"},xt={key:2,class:"text-center py-8 text-gray-500"},ct=U({__name:"WorkExecutionDetailDialog",props:{isOpen:{type:Boolean},periodStart:{},periodEnd:{},filters:{}},emits:["close"],setup(m,{emit:y}){const i=m,k=y,x=W(),b=f(!1),c=f([]);function v(o){return new Date(o).toLocaleDateString("ru-RU")}function h(o){return new Intl.NumberFormat("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2}).format(o)}async function q(){if(i.isOpen){b.value=!0;try{const o={period_from:i.periodStart,period_to:i.periodEnd,page_size:1e3};i.filters.object_id&&(o.object_id=i.filters.object_id),i.filters.estimate_id&&(o.estimate_id=i.filters.estimate_id),i.filters.work_id&&(o.work_id=i.filters.work_id);const l=await J(o);c.value=l.data}catch(o){console.error("Failed to load work execution movements:",o)}finally{b.value=!1}}}function _(){k("close")}function n(o){o.recorder_type==="estimate"?x.push(`/documents/estimates/${o.recorder_id}`):o.recorder_type==="daily_report"&&x.push(`/documents/daily-reports/${o.recorder_id}`),_()}return L(()=>i.isOpen,o=>{o&&q()}),(o,l)=>m.isOpen?(d(),u("div",{key:0,class:"fixed inset-0 z-50 overflow-y-auto",onClick:M(_,["self"])},[t("div",K,[t("div",{class:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75",onClick:_}),t("div",Q,[t("div",X,[t("div",{class:"flex items-center justify-between"},[l[1]||(l[1]=t("h3",{class:"text-lg font-medium text-gray-900"}," Детализация выполнения работ ",-1)),t("button",{onClick:_,class:"text-gray-400 hover:text-gray-500"},[...l[0]||(l[0]=[t("span",{class:"sr-only"},"Закрыть",-1),t("svg",{class:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("p",Y," Период: "+r(v(m.periodStart))+" - "+r(v(m.periodEnd)),1)]),t("div",Z,[b.value?(d(),u("div",tt,[...l[2]||(l[2]=[t("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),t("p",{class:"mt-2 text-sm text-gray-600"},"Загрузка...",-1)])])):c.value.length>0?(d(),u("div",et,[t("table",st,[l[3]||(l[3]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Тип документа "),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Номер/Дата "),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Дата движения "),t("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase"}," Приход кол-во "),t("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase"}," Расход кол-во "),t("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase"}," Приход сумма "),t("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase"}," Расход сумма ")])],-1)),t("tbody",at,[(d(!0),u(C,null,E(c.value,p=>(d(),u("tr",{key:p.id,class:"hover:bg-gray-50 cursor-pointer",onDblclick:F=>n(p)},[t("td",rt,r(p.recorder_type==="estimate"?"Смета":"Ежедневный отчет"),1),t("td",lt,r(p.estimate_number||v(p.period)),1),t("td",ot,r(v(p.period)),1),t("td",nt,r(h(p.quantity_income)),1),t("td",dt,r(h(p.quantity_expense)),1),t("td",ut,r(h(p.sum_income)),1),t("td",pt,r(h(p.sum_expense)),1)],40,it))),128))])]),l[4]||(l[4]=t("p",{class:"mt-4 text-sm text-gray-500 italic"}," Дважды кликните на строку, чтобы открыть документ ",-1))])):(d(),u("div",xt," Нет данных "))]),t("div",{class:"px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end"},[t("button",{onClick:_,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50"}," Закрыть ")])])])])):R("",!0)}}),mt={class:"space-y-6"},yt={class:"bg-white shadow rounded-lg p-6"},_t={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},gt={class:"bg-white shadow rounded-lg p-6"},ft={key:0,class:"text-center py-8"},bt={key:1,class:"space-y-4"},vt={class:"hidden md:block overflow-x-auto"},ht={class:"min-w-full divide-y divide-gray-200"},wt={class:"bg-white divide-y divide-gray-200"},kt=["onDblclick"],$t={class:"px-4 py-3 text-sm text-gray-900"},qt={class:"px-4 py-3 text-sm text-gray-900"},jt={class:"px-4 py-3 text-sm text-gray-900"},Dt={class:"px-4 py-3 text-sm text-gray-900"},Vt={class:"px-4 py-3 text-sm text-right text-gray-900"},Ct={class:"px-4 py-3 text-sm text-right text-gray-900"},Et={class:"px-4 py-3 text-sm text-right text-gray-900"},Ft={class:"px-4 py-3 text-sm text-right text-gray-900"},Ot={class:"bg-gray-50 font-semibold"},St={class:"px-4 py-3 text-sm text-right text-gray-900"},Ut={class:"px-4 py-3 text-sm text-right text-gray-900"},Rt={class:"px-4 py-3 text-sm text-right text-gray-900"},Bt={class:"px-4 py-3 text-sm text-right text-gray-900"},Nt={class:"md:hidden space-y-4"},Lt=["onClick"],Mt={class:"grid grid-cols-2 gap-2 text-sm"},Wt={class:"ml-2 text-gray-900"},zt={class:"ml-2 text-gray-900"},At={class:"ml-2 text-gray-900"},It={class:"ml-2 text-gray-900"},Pt={class:"border-t pt-2 grid grid-cols-2 gap-2 text-sm"},Tt={class:"ml-2 text-gray-900"},Gt={class:"ml-2 text-gray-900"},Ht={class:"col-span-2"},Jt={class:"border-2 border-gray-300 rounded-lg p-4 bg-gray-50"},Kt={class:"grid grid-cols-2 gap-2 text-sm"},Qt={class:"ml-2 text-gray-900"},Xt={class:"ml-2 text-gray-900"},Yt={class:"col-span-2"},Zt={key:2,class:"text-center py-8 text-gray-500"},te={key:3,class:"mt-4 text-sm text-gray-500 italic"},re=U({__name:"WorkExecutionView",setup(m){const y=T(),i=f({period_from:"",period_to:"",object_id:null,estimate_id:null,work_id:null,group_by:""}),k=f(!1),x=f([]),b=f([]),c=f({isOpen:!1,periodStart:"",periodEnd:"",filters:{}}),v=[{value:"",label:"Без группировки"},{value:"object",label:"По объекту"},{value:"estimate",label:"По смете"},{value:"work",label:"По работе"}],h=$(()=>y.objects.filter(a=>!a.is_deleted).map(a=>({id:a.id,name:a.name}))),q=$(()=>y.works.filter(a=>!a.is_deleted).map(a=>({id:a.id,name:a.name}))),_=$(()=>b.value.map(a=>({id:a.id,name:`${a.number} от ${o(a.date)}`}))),n=$(()=>x.value.reduce((a,e)=>(a.income_quantity+=e.income_quantity,a.income_sum+=e.income_sum,a.expense_quantity+=e.expense_quantity,a.expense_sum+=e.expense_sum,a.balance_quantity+=e.balance_quantity,a.balance_sum+=e.balance_sum,a),{income_quantity:0,income_sum:0,expense_quantity:0,expense_sum:0,balance_quantity:0,balance_sum:0}));function o(a){return new Date(a).toLocaleDateString("ru-RU")}function l(a){return new Intl.NumberFormat("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2}).format(a)}async function p(){k.value=!0;try{const a={};i.value.period_from&&(a.period_from=i.value.period_from),i.value.period_to&&(a.period_to=i.value.period_to),i.value.object_id&&(a.object_id=i.value.object_id),i.value.estimate_id&&(a.estimate_id=i.value.estimate_id),i.value.work_id&&(a.work_id=i.value.work_id),i.value.group_by&&(a.group_by=i.value.group_by);const e=await H(a);x.value=e.data}catch(a){console.error("Failed to load work execution register:",a)}finally{k.value=!1}}function F(){p()}function B(){i.value={period_from:"",period_to:"",object_id:null,estimate_id:null,work_id:null,group_by:""},x.value=[]}function O(a){!i.value.period_from||!i.value.period_to||(c.value={isOpen:!0,periodStart:i.value.period_from,periodEnd:i.value.period_to,filters:{object_id:a.object_id||i.value.object_id,estimate_id:a.estimate_id||i.value.estimate_id,work_id:a.work_id||i.value.work_id}})}return z(async()=>{await Promise.all([y.fetchObjects(),y.fetchWorks()]);try{const{default:a}=await A(async()=>{const{default:s}=await import("./documents-D6jJUN3y.js");return{default:s}},__vite__mapDeps([0,1,2])),e=await a.getEstimates({page_size:1e3});b.value=e.data.map(s=>({id:s.id,number:s.number,date:s.date}))}catch(a){console.error("Failed to load estimates:",a)}}),(a,e)=>(d(),I(G,null,{default:P(()=>[t("div",mt,[e[22]||(e[22]=t("div",null,[t("h2",{class:"text-2xl font-bold text-gray-900"},"Регистр выполнения работ"),t("p",{class:"mt-1 text-sm text-gray-600"},"Просмотр движений по выполнению работ")],-1)),t("div",yt,[e[7]||(e[7]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Фильтры",-1)),t("div",_t,[g(D,{modelValue:i.value.period_from,"onUpdate:modelValue":e[0]||(e[0]=s=>i.value.period_from=s),label:"Период с",type:"date"},null,8,["modelValue"]),g(D,{modelValue:i.value.period_to,"onUpdate:modelValue":e[1]||(e[1]=s=>i.value.period_to=s),label:"Период по",type:"date"},null,8,["modelValue"]),g(V,{modelValue:i.value.object_id,"onUpdate:modelValue":e[2]||(e[2]=s=>i.value.object_id=s),label:"Объект",items:h.value,placeholder:"Все объекты"},null,8,["modelValue","items"]),g(V,{modelValue:i.value.estimate_id,"onUpdate:modelValue":e[3]||(e[3]=s=>i.value.estimate_id=s),label:"Смета",items:_.value,placeholder:"Все сметы"},null,8,["modelValue","items"]),g(V,{modelValue:i.value.work_id,"onUpdate:modelValue":e[4]||(e[4]=s=>i.value.work_id=s),label:"Работа",items:q.value,placeholder:"Все работы"},null,8,["modelValue","items"]),g(D,{modelValue:i.value.group_by,"onUpdate:modelValue":e[5]||(e[5]=s=>i.value.group_by=s),label:"Группировка",type:"select",options:v},null,8,["modelValue"])]),t("div",{class:"mt-4 flex space-x-3"},[t("button",{onClick:F,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"}," Применить "),t("button",{onClick:B,class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Сбросить ")])]),t("div",gt,[k.value?(d(),u("div",ft,[...e[8]||(e[8]=[t("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),t("p",{class:"mt-2 text-sm text-gray-600"},"Загрузка...",-1)])])):x.value.length>0?(d(),u("div",bt,[t("div",vt,[t("table",ht,[e[10]||(e[10]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Период "),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Объект "),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Смета "),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Работа "),t("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase"}," Приход кол. "),t("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase"}," Приход сумма "),t("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase"}," Расход кол. "),t("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase"}," Расход сумма "),t("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase"}," Остаток кол. "),t("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase"}," Остаток сумма ")])],-1)),t("tbody",wt,[(d(!0),u(C,null,E(x.value,(s,j)=>(d(),u("tr",{key:j,class:"hover:bg-gray-50 cursor-pointer",onDblclick:N=>O(s)},[t("td",$t,r(o(s.period)),1),t("td",qt,r(s.object_name),1),t("td",jt,r(s.estimate_number),1),t("td",Dt,r(s.work_name),1),t("td",Vt,r(l(s.income_quantity)),1),t("td",Ct,r(l(s.income_sum)),1),t("td",Et,r(l(s.expense_quantity)),1),t("td",Ft,r(l(s.expense_sum)),1),t("td",{class:w(["px-4 py-3 text-sm text-right font-medium",s.balance_quantity>=0?"text-green-600":"text-red-600"])},r(l(s.balance_quantity)),3),t("td",{class:w(["px-4 py-3 text-sm text-right font-medium",s.balance_sum>=0?"text-green-600":"text-red-600"])},r(l(s.balance_sum)),3)],40,kt))),128)),t("tr",Ot,[e[9]||(e[9]=t("td",{colspan:"4",class:"px-4 py-3 text-sm text-gray-900"},"Итого:",-1)),t("td",St,r(l(n.value.income_quantity)),1),t("td",Ut,r(l(n.value.income_sum)),1),t("td",Rt,r(l(n.value.expense_quantity)),1),t("td",Bt,r(l(n.value.expense_sum)),1),t("td",{class:w(["px-4 py-3 text-sm text-right",n.value.balance_quantity>=0?"text-green-600":"text-red-600"])},r(l(n.value.balance_quantity)),3),t("td",{class:w(["px-4 py-3 text-sm text-right",n.value.balance_sum>=0?"text-green-600":"text-red-600"])},r(l(n.value.balance_sum)),3)])])])]),t("div",Nt,[(d(!0),u(C,null,E(x.value,(s,j)=>(d(),u("div",{key:j,class:"border border-gray-200 rounded-lg p-4 space-y-2 cursor-pointer hover:bg-gray-50",onClick:N=>O(s)},[t("div",Mt,[t("div",null,[e[11]||(e[11]=t("span",{class:"text-gray-500"},"Период:",-1)),t("span",Wt,r(o(s.period)),1)]),t("div",null,[e[12]||(e[12]=t("span",{class:"text-gray-500"},"Объект:",-1)),t("span",zt,r(s.object_name),1)]),t("div",null,[e[13]||(e[13]=t("span",{class:"text-gray-500"},"Смета:",-1)),t("span",At,r(s.estimate_number),1)]),t("div",null,[e[14]||(e[14]=t("span",{class:"text-gray-500"},"Работа:",-1)),t("span",It,r(s.work_name),1)])]),t("div",Pt,[t("div",null,[e[15]||(e[15]=t("span",{class:"text-gray-500"},"Приход:",-1)),t("span",Tt,r(l(s.income_quantity))+" / "+r(l(s.income_sum)),1)]),t("div",null,[e[16]||(e[16]=t("span",{class:"text-gray-500"},"Расход:",-1)),t("span",Gt,r(l(s.expense_quantity))+" / "+r(l(s.expense_sum)),1)]),t("div",Ht,[e[17]||(e[17]=t("span",{class:"text-gray-500"},"Остаток:",-1)),t("span",{class:w(["ml-2 font-medium",s.balance_quantity>=0?"text-green-600":"text-red-600"])},r(l(s.balance_quantity))+" / "+r(l(s.balance_sum)),3)])])],8,Lt))),128)),t("div",Jt,[e[21]||(e[21]=t("div",{class:"text-sm font-semibold text-gray-900 mb-2"},"Итого:",-1)),t("div",Kt,[t("div",null,[e[18]||(e[18]=t("span",{class:"text-gray-500"},"Приход:",-1)),t("span",Qt,r(l(n.value.income_quantity))+" / "+r(l(n.value.income_sum)),1)]),t("div",null,[e[19]||(e[19]=t("span",{class:"text-gray-500"},"Расход:",-1)),t("span",Xt,r(l(n.value.expense_quantity))+" / "+r(l(n.value.expense_sum)),1)]),t("div",Yt,[e[20]||(e[20]=t("span",{class:"text-gray-500"},"Остаток:",-1)),t("span",{class:w(["ml-2 font-semibold",n.value.balance_sum>=0?"text-green-600":"text-red-600"])},r(l(n.value.balance_quantity))+" / "+r(l(n.value.balance_sum)),3)])])])])])):(d(),u("div",Zt," Нет данных. Примените фильтры для поиска. ")),x.value.length>0?(d(),u("p",te," Дважды кликните на строку, чтобы открыть детализацию ")):R("",!0)])]),g(ct,{"is-open":c.value.isOpen,"period-start":c.value.periodStart,"period-end":c.value.periodEnd,filters:c.value.filters,onClose:e[6]||(e[6]=s=>c.value.isOpen=!1)},null,8,["is-open","period-start","period-end","filters"])]),_:1}))}});export{re as default};
