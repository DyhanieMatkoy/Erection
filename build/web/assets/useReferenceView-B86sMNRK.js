import{u as C}from"./DataTable.vue_vue_type_script_setup_true_lang-BHfRwsQq.js";import{u as D}from"./FormField.vue_vue_type_script_setup_true_lang-BSC5W8r_.js";import{f as u,g as _}from"./index-BmuF08LN.js";function x(d,f){D();const e=C(),o=u(!1),t=u(null),n=u({name:"",parent_id:null}),i=u({}),s=u(""),c=u(!1),m=_(()=>e.data.value.filter(a=>!a.is_deleted&&a.id!==t.value?.id).map(a=>({id:a.id,name:a.name})));function p(a){return e.data.value.find(v=>v.id===a)?.name||""}async function l(){e.loading.value=!0;try{const a=await d.getAll(e.queryParams.value);e.data.value=a.data,e.pagination.value=a.pagination,f&&await f()}catch(a){console.error("Failed to load data:",a)}finally{e.loading.value=!1}}function h(a){e.setPage(a),l()}function g(a){e.setSearch(a),l()}function y(a,r){e.setSort(a,r),l()}function w(){t.value=null,n.value={name:"",parent_id:null},i.value={},s.value="",o.value=!0}function S(a){t.value=a,n.value={...a},i.value={},s.value="",o.value=!0}async function b(){if(i.value={},!n.value.name?.trim()){i.value.name="Обязательное поле";return}c.value=!0,s.value="";try{t.value?.id?await d.update(t.value.id,n.value):await d.create(n.value),o.value=!1,await l()}catch(a){const r=a;s.value=r.response?.data?.detail||"Ошибка при сохранении"}finally{c.value=!1}}async function E(a){if(confirm(`Удалить "${a.name}"?`))try{await d.delete(a.id),await l()}catch(r){alert(r.response?.data?.detail||"Ошибка при удалении")}}function P(){o.value=!1,t.value=null}return{table:e,modalOpen:o,editingItem:t,formData:n,errors:i,submitError:s,submitting:c,parentItems:m,getParentName:p,loadData:l,handlePageChange:h,handleSearch:g,handleSort:y,handleCreate:w,handleEdit:S,handleSubmit:b,handleDelete:E,handleCloseModal:P}}export{x as u};
