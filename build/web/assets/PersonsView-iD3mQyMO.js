import{d as M,f as x,h as R,c as $,w as a,a as t,b,i as c,u as s,n as B,j as d,t as u,e as v,l as p,v as f,k as j,o as i}from"./index-DUoOKtDv.js";import{u as F}from"./useReferenceView-C-9YuCMZ.js";import{u as U}from"./useFilters-CZ5mbCA9.js";import{u as E,p as z,q as A,r as N,s as q,t as I}from"./references-eDFEYnSt.js";import{_ as H}from"./AppLayout.vue_vue_type_script_setup_true_lang-B3MB7avE.js";import{_ as O}from"./DataTable.vue_vue_type_script_setup_true_lang-DTxzDPkq.js";import{_ as T}from"./Modal.vue_vue_type_script_setup_true_lang-pxS1gZgL.js";import{_ as G}from"./FormField.vue_vue_type_script_setup_true_lang-BL-nFudA.js";const J={class:"space-y-6"},K={key:0,class:"text-sm text-gray-900"},Q={key:1,class:"text-gray-400"},W={key:0,class:"text-sm text-gray-900"},X={key:1,class:"text-gray-400"},Y={key:0,class:"text-sm text-gray-900"},Z={key:1,class:"text-gray-400"},ee={class:"flex items-center justify-center"},te=["title"],le={key:0,class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},se={key:1,class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},oe=["onClick"],ne=["onClick"],ae={key:0,class:"rounded-md bg-red-50 p-4"},re={class:"text-sm text-red-800"},ie=["disabled"],ve=M({__name:"PersonsView",setup(de){const y=E(),o=F({getAll:I,create:q,update:N,delete:A},()=>y.fetchPersons(!0)),g=x(),m=x([]),r=U({position:null,specialty:null,status:null,isDeleted:null}),h=[{key:"personnel_number",label:"Табельный №",width:"100px"},{key:"name",label:"ФИО",width:"250px"},{key:"position",label:"Должность",width:"150px"},{key:"specialty",label:"Специальность",width:"150px"},{key:"phone",label:"Телефон",width:"150px"},{key:"hire_date",label:"Дата приема",width:"100px"},{key:"status",label:"Статус",width:"100px"},{key:"is_deleted",label:"",width:"40px",sortable:!1}];function k(n){m.value=n}async function w(){if(m.value.length!==0&&confirm(`Удалить выбранных работников (${m.value.length})?`))try{const n=m.value.map(l=>l.id),e=await z(n);e.errors.length>0?alert(`${e.message}

Ошибки:
${e.errors.join(`
`)}`):alert(e.message),g.value?.clearSelection(),await o.loadData()}catch(n){alert(n.response?.data?.detail||"Ошибка при групповом удалении")}}function C(){r.applyFilters(),o.table.setPage(1),o.loadData()}function S(){r.clearAllFilters(),o.table.setPage(1),o.loadData()}function _(n){return{foreman:"Бригадир",worker:"Рабочий",engineer:"Инженер",manager:"Менеджер"}[n]||n}function D(n){return{electrician:"Электрик",plumber:"Сантехник",carpenter:"Плотник",mason:"Каменщик"}[n]||n}function P(n){return{active:"Работает",dismissed:"Уволен"}[n]||n}function V(n){return n?new Date(n).toLocaleDateString("ru-RU"):"—"}return R(()=>{o.loadData()}),(n,e)=>(i(),$(H,null,{default:a(()=>[t("div",J,[e[20]||(e[20]=t("div",null,[t("h2",{class:"text-2xl font-bold text-gray-900"},"Физические лица"),t("p",{class:"mt-1 text-sm text-gray-600"},"Управление справочником физических лиц")],-1)),b(O,{ref_key:"tableRef",ref:g,columns:h,data:s(o).table.data.value,loading:s(o).table.loading.value,pagination:s(o).table.pagination.value,selectable:!0,"has-filters":!0,onRowClick:s(o).handleEdit,onPageChange:s(o).handlePageChange,onSearch:s(o).handleSearch,onSort:s(o).handleSort,onSelectionChange:k,onRefresh:s(o).loadData,onApplyFilters:C,onClearFilters:S},{filters:a(()=>[t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Должность",-1)),p(t("select",{"onUpdate:modelValue":e[0]||(e[0]=l=>s(r).filters.value.position=l),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"},[...e[9]||(e[9]=[t("option",{value:null},"Все должности",-1),t("option",{value:"foreman"},"Бригадир",-1),t("option",{value:"worker"},"Рабочий",-1),t("option",{value:"engineer"},"Инженер",-1),t("option",{value:"manager"},"Менеджер",-1)])],512),[[f,s(r).filters.value.position]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Специальность",-1)),p(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>s(r).filters.value.specialty=l),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"},[...e[11]||(e[11]=[t("option",{value:null},"Все специальности",-1),t("option",{value:"electrician"},"Электрик",-1),t("option",{value:"plumber"},"Сантехник",-1),t("option",{value:"carpenter"},"Плотник",-1),t("option",{value:"mason"},"Каменщик",-1)])],512),[[f,s(r).filters.value.specialty]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Статус",-1)),p(t("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>s(r).filters.value.status=l),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"},[...e[13]||(e[13]=[t("option",{value:null},"Все",-1),t("option",{value:"active"},"Работает",-1),t("option",{value:"dismissed"},"Уволен",-1)])],512),[[f,s(r).filters.value.status]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Удаленные",-1)),p(t("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>s(r).filters.value.isDeleted=l),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"},[...e[15]||(e[15]=[t("option",{value:null},"Все",-1),t("option",{value:!1},"Активные",-1),t("option",{value:!0},"Удаленные",-1)])],512),[[f,s(r).filters.value.isDeleted]])])]),"bulk-actions":a(({selected:l})=>[t("button",{onClick:w,class:"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700"}," Удалить ("+u(l.length)+") ",1)]),"header-actions":a(()=>[t("button",{onClick:e[4]||(e[4]=(...l)=>s(o).handleCreate&&s(o).handleCreate(...l)),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700"},[...e[17]||(e[17]=[t("svg",{class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),v(" Создать ",-1)])])]),"cell-position":a(({value:l})=>[l?(i(),d("span",K,u(_(l)),1)):(i(),d("span",Q,"—"))]),"cell-specialty":a(({value:l})=>[l?(i(),d("span",W,u(D(l)),1)):(i(),d("span",X,"—"))]),"cell-hire_date":a(({value:l})=>[v(u(V(l)),1)]),"cell-status":a(({value:l})=>[l?(i(),d("span",Y,u(P(l)),1)):(i(),d("span",Z,"—"))]),"cell-is_deleted":a(({value:l})=>[t("div",ee,[t("span",{class:B(["inline-flex items-center justify-center w-6 h-6 rounded-full",l?"bg-red-100 text-red-600":"bg-green-100 text-green-600"]),title:l?"Удален":"Активен"},[l?(i(),d("svg",le,[...e[18]||(e[18]=[t("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"},null,-1)])])):(i(),d("svg",se,[...e[19]||(e[19]=[t("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)])]))],10,te)])]),actions:a(({row:l})=>[t("button",{onClick:c(L=>s(o).handleEdit(l),["stop"]),class:"text-blue-600 hover:text-blue-900 mr-4"}," Изменить ",8,oe),t("button",{onClick:c(L=>s(o).handleDelete(l),["stop"]),class:"text-red-600 hover:text-red-900"}," Удалить ",8,ne)]),_:1},8,["data","loading","pagination","onRowClick","onPageChange","onSearch","onSort","onRefresh"]),b(T,{open:s(o).modalOpen.value,title:s(o).editingItem.value?"Редактирование физического лица":"Создание физического лица",size:"md",onClose:s(o).handleCloseModal},{footer:a(()=>[t("button",{onClick:e[7]||(e[7]=(...l)=>s(o).handleCloseModal&&s(o).handleCloseModal(...l)),type:"button",class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Отмена "),t("button",{onClick:e[8]||(e[8]=(...l)=>s(o).handleSubmit&&s(o).handleSubmit(...l)),type:"button",disabled:s(o).submitting.value,class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50"},u(s(o).submitting.value?"Сохранение...":"Сохранить"),9,ie)]),default:a(()=>[t("form",{onSubmit:e[6]||(e[6]=c((...l)=>s(o).handleSubmit&&s(o).handleSubmit(...l),["prevent"])),class:"space-y-4"},[b(G,{modelValue:s(o).formData.value.name,"onUpdate:modelValue":e[5]||(e[5]=l=>s(o).formData.value.name=l),label:"ФИО",type:"text",required:"",error:s(o).errors.value.name},null,8,["modelValue","error"]),s(o).submitError.value?(i(),d("div",ae,[t("p",re,u(s(o).submitError.value),1)])):j("",!0)],32)]),_:1},8,["open","title","onClose"])])]),_:1}))}});export{ve as default};
