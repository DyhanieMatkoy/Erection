import{d as P,f as g,h as j,c as V,w as s,a as r,b as N,j as h,k as b,i as y,n as M,t as i,e as x,u as d,l as U,o as u}from"./index-B1sRxO42.js";import{u as L,_ as T}from"./DataTable.vue_vue_type_script_setup_true_lang-DOc6hnFw.js";import{getDailyReports as q,deleteDailyReport as z,bulkDeleteDailyReports as F,bulkPostDailyReports as H,bulkUnpostDailyReports as I}from"./documents-BqcbhH-2.js";import{_ as A}from"./AppLayout.vue_vue_type_script_setup_true_lang-D5nXF41d.js";const G={class:"space-y-6"},J={key:0,class:"flex gap-2"},K=["onClick"],O=["onClick"],ee=P({__name:"DailyReportListView",setup(Q){const p=U(),n=L(),c=g(),o=g([]),v=[{key:"date",label:"Дата"},{key:"estimate_number",label:"Смета"},{key:"foreman_name",label:"Бригадир"},{key:"is_posted",label:"Статус"}];function m(e){return new Date(e).toLocaleDateString("ru-RU")}async function l(){n.loading.value=!0;try{const e=await q(n.queryParams.value);n.data.value=e.data,n.pagination.value=e.pagination}catch(e){console.error("Failed to load daily reports:",e)}finally{n.loading.value=!1}}function k(e){n.setPage(e),l()}function _(e){n.setSearch(e),l()}function w(e,t){n.setSort(e,t),l()}function C(){p.push("/documents/daily-reports/new")}function f(e){p.push(`/documents/daily-reports/${e.id}`)}async function $(e){if(confirm(`Удалить отчет от ${m(e.date)}?`))try{await z(e.id),await l()}catch(t){alert(t.response?.data?.detail||"Ошибка при удалении")}}function D(e){o.value=e}async function S(){if(o.value.length!==0&&confirm(`Удалить выбранные отчеты (${o.value.length})?`))try{const e=o.value.map(a=>a.id),t=await F(e);t.errors.length>0?alert(`${t.message}

Ошибки:
${t.errors.join(`
`)}`):alert(t.message),c.value?.clearSelection(),await l()}catch(e){alert(e.response?.data?.detail||"Ошибка при групповом удалении")}}async function R(){if(o.value.length!==0&&confirm(`Провести выбранные отчеты (${o.value.length})?`))try{const e=o.value.map(a=>a.id),t=await H(e);t.errors.length>0?alert(`${t.message}

Ошибки:
${t.errors.join(`
`)}`):alert(t.message),c.value?.clearSelection(),await l()}catch(e){alert(e.response?.data?.detail||"Ошибка при групповом проведении")}}async function E(){if(o.value.length!==0&&confirm(`Отменить проведение выбранных отчетов (${o.value.length})?`))try{const e=o.value.map(a=>a.id),t=await I(e);t.errors.length>0?alert(`${t.message}

Ошибки:
${t.errors.join(`
`)}`):alert(t.message),c.value?.clearSelection(),await l()}catch(e){alert(e.response?.data?.detail||"Ошибка при отмене проведения")}}return j(()=>{l()}),(e,t)=>(u(),V(A,null,{default:s(()=>[r("div",G,[t[1]||(t[1]=r("div",null,[r("h2",{class:"text-2xl font-bold text-gray-900"},"Ежедневные отчеты"),r("p",{class:"mt-1 text-sm text-gray-600"},"Управление ежедневными отчетами")],-1)),N(T,{ref_key:"tableRef",ref:c,columns:v,data:d(n).data.value,loading:d(n).loading.value,pagination:d(n).pagination.value,selectable:!0,onRowClick:f,onPageChange:k,onSearch:_,onSort:w,onSelectionChange:D},{"bulk-actions":s(({selected:a})=>[a.length>0?(u(),h("div",J,[r("button",{onClick:R,class:"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700"}," Провести ("+i(a.length)+") ",1),r("button",{onClick:E,class:"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-yellow-600 hover:bg-yellow-700"}," Отменить проведение ("+i(a.length)+") ",1),r("button",{onClick:S,class:"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700"}," Удалить ("+i(a.length)+") ",1)])):b("",!0)]),"header-actions":s(()=>[r("button",{onClick:C,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700"},[...t[0]||(t[0]=[r("svg",{class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),x(" Создать отчет ",-1)])])]),"cell-date":s(({value:a})=>[x(i(m(a)),1)]),"cell-is_posted":s(({value:a})=>[r("span",{class:M(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",a?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},i(a?"Проведен":"Не проведен"),3)]),actions:s(({row:a})=>[r("button",{onClick:y(B=>f(a),["stop"]),class:"text-blue-600 hover:text-blue-900 mr-4"}," Открыть ",8,K),a.is_posted?b("",!0):(u(),h("button",{key:0,onClick:y(B=>$(a),["stop"]),class:"text-red-600 hover:text-red-900"}," Удалить ",8,O))]),_:1},8,["data","loading","pagination"])])]),_:1}))}});export{ee as default};
