# План реализации системы управления рабочим временем строительных бригад (PyQt6)

- [x] 1. Настройка проекта и базовой инфраструктуры
  - Создать структуру Python проекта
  - Настроить виртуальное окружение
  - Установить зависимости (PyQt6, openpyxl, reportlab)
  - Создать структуру каталогов (models, views, viewmodels, services, repositories)
  - Создать requirements.txt
  - _Requirements: 1.1, 8.1_

- [x] 2. Реализация слоя данных (Data Layer)
- [x] 2.1 Создать схему базы данных
  - Написать SQL-скрипт создания всех таблиц
  - Создать индексы для оптимизации запросов
  - Реализовать класс DatabaseManager для инициализации и управления подключением к БД
  - _Requirements: 1.2, 2.2, 4.2, 4.4, 5.1_

- [x] 2.2 Реализовать модели данных
  - Создать базовый класс BaseModel
  - Реализовать dataclasses для моделей
  - _Requirements: 1.2, 2.2, 4.2, 4.4, 5.1_

- [x] 2.3 Реализовать базовый репозиторий
  - Создать класс BaseRepository с методами CRUD
  - Реализовать методы работы с транзакциями
  - _Requirements: 4.1, 4.5_

- [x] 2.4 Реализовать специализированные репозитории
  - Создать EstimateRepository
  - Создать DailyReportRepository
  - Создать UserRepository
  - _Requirements: 2.1, 2.2, 4.5, 5.2, 5.3_

- [x] 3. Реализация бизнес-логики (Business Logic Layer)
- [x] 3.1 Реализовать CalculatorService
  - Создать методы расчетов
  - _Requirements: 1.3, 2.3, 8.4, 8.5, 8.6, 8.7, 8.8_

- [x] 3.2 Реализовать ValidationService
  - Реализовать валидацию документов
  - _Requirements: 2.4, 4.5_

- [x] 3.3 Реализовать AuthService
  - Реализовать метод login с хешированием паролей
  - Реализовать метод logout
  - Создать метод has_permission
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5_

- [x] 3.4 Реализовать EstimateService
  - Создать методы create, load, save
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 3.5 Реализовать DailyReportService
  - Создать методы create, save
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5_

- [ ] 3.6 Реализовать AnalyticsService
  - Создать метод get_analytics
  - Реализовать экспорт в различные форматы
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 4. Реализация слоя представления моделей (ViewModel Layer)
- [x] 4.1 Создать базовые ViewModel классы
  - Реализовать ListViewModel
  - Реализовать DocumentViewModel
  - _Requirements: 8.1, 8.15_

- [x] 4.2 Реализовать EstimateViewModel
  - Наследовать от DocumentViewModel
  - Реализовать автоматический пересчет
  - _Requirements: 1.2, 1.3, 8.4, 8.5, 8.6, 8.7, 8.8_

- [x] 4.3 Реализовать DailyReportViewModel
  - Наследовать от DocumentViewModel
  - _Requirements: 2.1, 2.2, 2.3, 2.4_

- [x] 4.4 Реализовать AnalyticsViewModel
  - Создать модель для фильтров
  - _Requirements: 3.1, 3.2, 3.3, 3.4_

- [x] 5. Реализация базовых UI компонентов
- [x] 5.1 Создать BaseListForm
  - Реализовать QWidget форму со списком
  - Добавить обработку горячих клавиш
  - _Requirements: 1.1, 8.1, 8.12, 8.13, 8.14_

- [x] 5.2 Создать BaseDocumentForm
  - Реализовать QWidget форму документа
  - Добавить обработку горячих клавиш
  - _Requirements: 8.2, 8.15_

- [x] 5.3 Создать BaseTablePart компонент
  - Реализовать QTableWidget для табличной части
  - _Requirements: 8.3, 8.4, 8.5, 8.6, 8.7, 8.8, 8.9, 8.10_

- [x] 5.4 Создать ReferencePickerDialog





  - Реализовать диалог выбора элемента справочника
  - _Requirements: 8.9_

- [x] 6. Реализация форм справочников
- [x] 6.1 Создать формы списков справочников
- [x] 6.2 Создать формы элементов справочников
- [x] 6.3 Реализовать проверку использования справочников
- [x] 6.4 Добавить поддержку групп в справочниках
  - Добавить поле is_group в таблицы справочников (persons, counterparties, objects, organizations, works)
  - Добавить кнопку "Создать группу" в формы списков справочников
  - Обновить формы элементов справочников для поддержки параметра is_group
  - Реализовать проверку циклических ссылок при выборе родителя
  - _Requirements: 4.6, 4.7, 4.8, 4.9, 4.10_



- [x] 7. Реализация форм документов
- [x] 7.1 Создать EstimateListForm и EstimateDocumentForm
- [x] 7.2 Реализовать импорт смет из Excel
- [x] 7.3 Создать DailyReportForm

- [x] 7.4 Реализовать структуру данных для группировки строк
  - Добавить поля is_group, group_name, parent_group_id, is_collapsed в таблицы estimate_lines и daily_report_lines
  - Обновить модели EstimateLine и DailyReportLine
  - Обновить репозитории для работы с новыми полями
  - _Requirements: 1.6, 1.7, 1.8, 1.9_

- [ ] 7.4.1 Реализовать UI для группировки строк (следующий этап)
  - Реализовать методы добавления строки группы в EstimateDocumentForm
  - Реализовать методы сворачивания/разворачивания групп
  - Реализовать визуальное отображение групп (отступы, иконки +/-)
  - _Requirements: 1.6, 1.7, 1.8, 1.9_

- [x] 7.5 Реализовать заполнение ежедневного отчета из сметы
  - Добавить реквизит ДокументОснование (estimate_id) в daily_reports
  - Создать EstimateLinePickerDialog для выбора строк сметы
  - Реализовать механизм отметки строк флажками
  - Реализовать механизм выделения диапазона мышью (через стандартное выделение Qt)
  - Добавить кнопку "Заполнить" в DailyReportDocumentForm
  - Добавить пункт контекстного меню "Создать Ежедневный отчет" в EstimateListForm
  - Реализовать метод fill_from_estimate в DailyReportService
  - _Requirements: 2.6, 2.7, 2.8, 2.9_



- [x] 8. Реализация печатных форм



- [x] 8.1 Создать PrintFormGenerator


- [x] 8.2 Реализовать печатную форму сметы


- [x] 8.3 Реализовать печатную форму ежедневного отчета



- [ ] 9. Реализация аналитических отчетов
- [ ] 9.1 Создать AnalyticsReportForm
- [ ] 9.2 Реализовать экспорт аналитики

- [x] 10. Реализация системы аутентификации и авторизации
- [x] 10.1 Создать LoginForm
  - _Requirements: 5.1_

- [x] 10.2 Реализовать фильтрацию данных по правам: бригадир видит только свои ежедневные отчеты, свои строки в отчете о выполненных работах





- [x] 10.3 Реализовать проверку прав доступа






- [x] 11. Реализация главного окна и навигации
- [x] 11.1 Создать MainWindow
  - _Requirements: 1.1, 2.1, 3.1, 4.1_

- [x] 11.2 Реализовать систему навигации






- [ ] 12. Настройки и конфигурация
- [ ] 12.1 Создать SettingsService
- [ ] 12.2 Создать SettingsForm

- [ ] 13. Интеграция и финальная сборка
- [ ] 13.1 Интегрировать все компоненты
- [ ] 13.2 Оптимизация производительности
- [ ] 13.3 Создать тестовые данные
- [ ] 13.4 Финальное тестирование
