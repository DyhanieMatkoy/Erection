# Требования к системе управления рабочим временем строительных бригад

## Введение

QT6 MVP для моделирования веб-приложения для управления рабочим временем строительных бригад. Система предназначена для учета строительных смет, контроля выполнения работ, учета трудозатрат и формирования отчетности.

## Глоссарь

- **УчетнаяСистема**: Приложение для управления материально-техническими ценностями и рабочим временем строительных бригад
- **ТМЦ**: Материально-технические ценности (оборудование, инструменты, материалы)
- **Мобильное_Приложение**: Android-приложение для работы с системой
- **Смета**: Документ, содержащий перечень работ с плановыми объемами, ценами и трудозатратами
- **Ежедневный_Отчет**: Документ учета фактических трудозатрат по работам сметы за день
- **Табличная_Часть**: Табличный раздел документа или формы, содержащий строки с данными

## Требования

### Требование 1

**Пользовательская история:** Как сотрудник, я хочу загружать из Excel и просматривать список строительных смет, чтобы управлять плановыми работами

#### Критерии приемки

1. КОГДА пользователь открывает форму списка смет, УчетнаяСистема ДОЛЖНА отобразить список с возможностью нажать Enter для просмотра существующей сметы или F9 для создания новой
2. КОГДА пользователь создает новую смету, УчетнаяСистема ДОЛЖНА предоставить форму с реквизитами: Номер (строка 20 символов), Дата (дата), Заказчик (справочник Контрагенты, строка 150 символов), Объект (справочник Объекты, подчинен Контрагенты), Подрядчик (справочник Организации, значение по умолчанию из константы ОсновнаяОрганизация), Ответственный (справочник Физлица, значение по умолчанию из поля ОсновнойОтветственный константы ОсновнаяОрганизация)
3. КОГДА пользователь добавляет работу в Табличная_Часть сметы, УчетнаяСистема ДОЛЖНА подставить из справочника Работы значения Цена и Норма_трудозатрат, умноженные на значение Количество
4. КОГДА пользователь запрашивает печатную форму сметы, УчетнаяСистема ДОЛЖНА сформировать документ в горизонтальной ориентации за время не более 3 секунд
5. КОГДА пользователь загружает файл Excel со сметой, УчетнаяСистема ДОЛЖНА распознать структуру и создать документ Смета с заполненными реквизитами и табличной частью
6. КОГДА пользователь добавляет строку группы в Табличная_Часть сметы, УчетнаяСистема ДОЛЖНА создать строку с признаком IsGroup=true и полем Наименование
7. КОГДА пользователь сворачивает/разворачивает группу в Табличная_Часть сметы, УчетнаяСистема ДОЛЖНА скрыть/показать все строки, принадлежащие этой группе
8. КОГДА пользователь добавляет обычную строку после группы, УчетнаяСистема ДОЛЖНА автоматически включить её в эту группу
9. КОГДА пользователь перемещает строку группы, УчетнаяСистема ДОЛЖНА переместить вместе с ней все вложенные строки

### Требование 2

**Пользовательская история:** Как бригадир, я хочу редактировать ежедневный отчет фактического исполнения плановых трудозатрат сметы, чтобы фиксировать выполненные объемы работ

#### Критерии приемки

1. КОГДА бригадир открывает форму Ежедневный_Отчет, УчетнаяСистема ДОЛЖНА отобразить список смет с незавершенными работами
2. КОГДА бригадир выбирает смету, УчетнаяСистема ДОЛЖНА отобразить Табличная_Часть с полями: Дата (дата), Работа (справочник Работы из сметы), Плановые_трудозатраты (число 10.2 из сметы), Фактические_трудозатраты (число 10.2, редактируемое), Исполнители (множественный выбор из справочника Физлица)
3. КОГДА бригадир вводит Фактические_трудозатраты, УчетнаяСистема ДОЛЖНА автоматически рассчитать поле Отклонение_процент как ((Фактические_трудозатраты - Плановые_трудозатраты) / Плановые_трудозатраты × 100)
4. КОГДА бригадир сохраняет Ежедневный_Отчет, УчетнаяСистема ДОЛЖНА проверить, что сумма Фактические_трудозатраты по всем исполнителям соответствует указанному значению с точностью до 0.1 часа
5. КОГДА запрашивается печатная форма Ежедневный_Отчет, УчетнаяСистема ДОЛЖНА сформировать документ в горизонтальной ориентации за время не более 5 секунд
6. КОГДА бригадир создает новый Ежедневный_Отчет, УчетнаяСистема ДОЛЖНА предоставить реквизит ДокументОснование со ссылкой на смету
7. КОГДА бригадир нажимает кнопку "Заполнить" в форме Ежедневный_Отчет, УчетнаяСистема ДОЛЖНА открыть форму выбора строк сметы с возможностью отметки строк флажками или выделения диапазона мышью
8. КОГДА бригадир выбирает строки сметы и подтверждает выбор, УчетнаяСистема ДОЛЖНА перенести выбранные строки в табличную часть Ежедневный_Отчет с заполнением полей Работа и Плановые_трудозатраты из сметы
9. КОГДА бригадир открывает форму списка смет и выбирает пункт контекстного меню "Создать Ежедневный отчет", УчетнаяСистема ДОЛЖНА создать новый Ежедневный_Отчет с заполненным реквизитом ДокументОснование и открыть форму выбора строк для заполнения

### Требование 3

**Пользовательская история:** Как руководитель проекта, я хочу просматривать аналитические отчеты по выполнению смет, чтобы контролировать ход работ и бюджет

#### Критерии приемки

1. КОГДА руководитель открывает форму аналитики, УчетнаяСистема ДОЛЖНА предоставить выбор периода анализа (день, неделя, месяц, произвольный период)
2. КОГДА выбран период, УчетнаяСистема ДОЛЖНА отобразить сводную таблицу с колонками: Смета, Объект, Плановые_трудозатраты (число 10.2), Фактические_трудозатраты (число 10.2), Отклонение_процент (число 5.2), Плановая_стоимость (число 15.2), Фактическая_стоимость (число 15.2), Отклонение_по_стоимости (число 15.2)
3. КОГДА запрашивается детализация по смете, УчетнаяСистема ДОЛЖНА показать разбивку по видам работ с указанием исполнителей из справочника Физлица
4. КОГДА руководитель запрашивает экспорт отчета, УчетнаяСистема ДОЛЖНА предоставить выбор формата (PDF, Excel, CSV) и сформировать файл за время не более 15 секунд
5. УчетнаяСистема ДОЛЖНА формировать аналитические отчеты за время не более 10 секунд

### Требование 4

**Пользовательская история:** Как администратор системы, я хочу управлять справочниками (Контрагенты, Объекты, Организации, Физлица, Работы), чтобы поддерживать актуальность данных

#### Критерии приемки

1. КОГДА администратор открывает справочник Контрагенты, УчетнаяСистема ДОЛЖНА отобразить список с возможностью добавления, редактирования и пометки на удаление записей
2. КОГДА администратор создает новый элемент справочника Контрагенты, УчетнаяСистема ДОЛЖНА запросить обязательные поля: Наименование (строка 150 символов), ИНН (строка 12 символов), Контактное_лицо (строка 100 символов), Телефон (строка 20 символов)
3. КОГДА администратор открывает справочник Объекты, УчетнаяСистема ДОЛЖНА отобразить иерархический список, подчиненный справочнику Контрагенты
4. КОГДА администратор создает новый элемент справочника Работы, УчетнаяСистема ДОЛЖНА запросить поля: Наименование (строка 200 символов), Код (строка 12 символов), Единица_измерения (справочник ЕдиницыИзмерения), Цена (число 15.2), Норма_трудозатрат (число 10.2)
5. КОГДА администратор пытается удалить элемент справочника, используемый в документах, УчетнаяСистема ДОЛЖНА запретить удаление и показать сообщение с указанием документов, где используется элемент
6. КОГДА администратор открывает форму списка справочника, УчетнаяСистема ДОЛЖНА предоставить кнопку "Создать" (Insert/F9) для создания нового элемента и кнопку "Создать группу" для создания группы элементов
7. КОГДА администратор создает группу в справочнике, УчетнаяСистема ДОЛЖНА создать элемент с признаком is_group=true и возможностью указания родительской группы
8. КОГДА администратор создает элемент справочника, УчетнаяСистема ДОЛЖНА предоставить возможность выбора родительской группы для организации иерархической структуры
9. КОГДА администратор открывает форму элемента справочника, УчетнаяСистема ДОЛЖНА отображать поле "Родитель" с возможностью выбора родительской группы или элемента
10. КОГДА администратор выбирает родителя для элемента, УчетнаяСистема ДОЛЖНА проверить отсутствие циклических ссылок и запретить выбор элемента в качестве родителя самого себя
11. КОГДА пользователь загружает файл Excel со сметой, УчетнаяСистема ДОЛЖНА извлечь 12-символьный код товара из колонки "Код" и сохранить его в справочнике Работы

### Требование 5

**Пользовательская история:** Как пользователь системы, я хочу иметь разграничение прав доступа, чтобы каждый сотрудник работал только со своими данными

#### Критерии приемки

1. КОГДА пользователь входит в систему, УчетнаяСистема ДОЛЖНА проверить его учетные данные и назначить роль (Администратор, Руководитель, Бригадир, Сотрудник)
2. КОГДА пользователь с ролью Бригадир открывает список смет, УчетнаяСистема ДОЛЖНА показать только сметы, где он указан как Ответственный
3. КОГДА пользователь с ролью Сотрудник открывает ежедневные отчеты, УчетнаяСистема ДОЛЖНА показать только отчеты, где он указан как Исполнитель
4. КОГДА пользователь с ролью Руководитель запрашивает аналитику, УчетнаяСистема ДОЛЖНА предоставить доступ ко всем сметам и отчетам организации
5. КОГДА пользователь пытается выполнить действие, не разрешенное его ролью, УчетнаяСистема ДОЛЖНА отклонить операцию и показать сообщение "Недостаточно прав для выполнения операции"

### Требование 6

**Пользовательская история:** Как пользователь мобильного приложения, я хочу вносить данные о выполненных работах с мобильного устройства на объекте

#### Критерии приемки

1. КОГДА пользователь открывает Мобильное_Приложение, УчетнаяСистема ДОЛЖНА синхронизировать актуальный список смет и работ за время не более 30 секунд
2. КОГДА пользователь в Мобильное_Приложение выбирает смету, УчетнаяСистема ДОЛЖНА отобразить список работ с возможностью ввода фактических трудозатрат
3. КОГДА пользователь вводит данные в Мобильное_Приложение в режиме офлайн, УчетнаяСистема ДОЛЖНА сохранить данные локально и синхронизировать их при появлении интернет-соединения
4. КОГДА происходит синхронизация данных, УчетнаяСистема ДОЛЖНА проверить наличие конфликтов и в случае обнаружения показать пользователю диалог разрешения конфликта
5. КОГДА пользователь завершает ввод данных за день, Мобильное_Приложение ДОЛЖНА отправить уведомление бригадиру о готовности отчета

### Требование 7

**Пользовательская история:** Как бухгалтер, я хочу формировать акты выполненных работ на основе ежедневных отчетов для расчетов с заказчиками

#### Критерии приемки

1. КОГДА бухгалтер открывает форму создания акта, УчетнаяСистема ДОЛЖНА предложить выбрать смету и период выполнения работ
2. КОГДА выбраны смета и период, УчетнаяСистема ДОЛЖНА автоматически заполнить Табличная_Часть акта данными из ежедневных отчетов с группировкой по видам работ
3. КОГДА бухгалтер формирует акт, УчетнаяСистема ДОЛЖНА рассчитать итоговую стоимость на основе фактически выполненных объемов и цен из сметы
4. КОГДА акт сохраняется, УчетнаяСистема ДОЛЖНА присвоить ему уникальный номер в формате "АКТ-ГГГГММДД-NNNN"
5. КОГДА запрашивается печатная форма акта, УчетнаяСистема ДОЛЖНА сформировать документ в соответствии с унифицированной формой КС-2 за время не более 5 секунд

### Требование 8

**Пользовательская история:** Как пользователь системы, я хочу проводить документы для формирования движений в регистре выполнения работ, чтобы отслеживать план-факт по сметам

#### Критерии приемки

1. КОГДА пользователь проводит документ Смета, УчетнаяСистема ДОЛЖНА создать записи в регистре накопления ВыполнениеРабот с приходом (+) по каждой строке табличной части с измерениями: Дата, Объект, Смета, Работа и ресурсами: Количество, Сумма
2. КОГДА пользователь проводит документ Ежедневный_Отчет, УчетнаяСистема ДОЛЖНА создать записи в регистре накопления ВыполнениеРабот с расходом (-) по каждой строке табличной части с измерениями: Дата, Объект, Смета, Работа и ресурсами: Количество (из фактических трудозатрат), Сумма (рассчитанная)
3. КОГДА пользователь отменяет проведение документа, УчетнаяСистема ДОЛЖНА удалить все движения документа из регистра ВыполнениеРабот
4. КОГДА пользователь изменяет проведенный документ, УчетнаяСистема ДОЛЖНА автоматически отменить проведение, позволить редактирование и предложить провести документ заново
5. КОГДА пользователь открывает отчет по выполнению работ, УчетнаяСистема ДОЛЖНА предоставить варианты группировки: по Объектам, по Сметам, по Работам, по Датам
6. КОГДА пользователь открывает отчет по выполнению работ, УчетнаяСистема ДОЛЖНА предоставить варианты отбора: по периоду, по Объекту, по Смете, по Работе
7. КОГДА формируется отчет по выполнению работ, УчетнаяСистема ДОЛЖНА показать колонки: План (количество), Факт (количество), Остаток (количество), План (сумма), Факт (сумма), Остаток (сумма), Процент выполнения
8. КОГДА пользователь запрашивает детализацию в отчете, УчетнаяСистема ДОЛЖНА показать список документов-регистраторов с возможностью перехода к документу

### Требование 9

**Пользовательская история:** Как пользователь системы, я хочу работать с формами списков и документов в стиле 1С 8.3 с привычными горячими клавишами и автоматическими пересчетами

#### Критерии приемки

1. КОГДА пользователь работает с формой списка, УчетнаяСистема ДОЛЖНА поддерживать горячие клавиши: Insert или F9 (создание нового элемента), Enter (открытие выбранного элемента), Delete (пометка на удаление), Ctrl+F (быстрый поиск), Ctrl+D (копирование элемента)
2. КОГДА пользователь работает с формой документа или элемента справочника, УчетнаяСистема ДОЛЖНА поддерживать горячие клавиши: Ctrl+S (записать), Ctrl+Shift+S (записать и закрыть), Esc (закрыть без сохранения с подтверждением при наличии изменений), Ctrl+P (печать), Ctrl+Enter (нажать кнопку по умолчанию)
3. КОГДА пользователь работает с Табличная_Часть документа, УчетнаяСистема ДОЛЖНА поддерживать горячие клавиши: Insert (добавить строку), Delete (удалить строку), F4 (открыть форму выбора для поля справочника), Ctrl+C/Ctrl+V (копировать/вставить строки), Ctrl+Plus/Ctrl+Minus (добавить/удалить строку)
4. КОГДА пользователь изменяет значение поля Количество в Табличная_Часть сметы, УчетнаяСистема ДОЛЖНА автоматически пересчитать поле Сумма как произведение Количество × Цена за время не более 100 миллисекунд
5. КОГДА пользователь изменяет значение поля Цена в Табличная_Часть сметы, УчетнаяСистема ДОЛЖНА автоматически пересчитать поле Сумма как произведение Количество × Цена за время не более 100 миллисекунд
6. КОГДА пользователь изменяет значение поля Норма_трудозатрат в Табличная_Часть сметы, УчетнаяСистема ДОЛЖНА автоматически пересчитать поле Плановые_трудозатраты как произведение Количество × Норма_трудозатрат за время не более 100 миллисекунд
7. КОГДА происходит изменение любой строки Табличная_Часть документа, УчетнаяСистема ДОЛЖНА автоматически пересчитать итоговые суммы документа (Итого_сумма, Итого_трудозатраты) за время не более 200 миллисекунд
8. КОГДА пользователь добавляет или удаляет строку в Табличная_Часть, УчетнаяСистема ДОЛЖНА автоматически пересчитать итоговые суммы документа за время не более 200 миллисекунд
9. КОГДА пользователь нажимает F4 в поле справочника, УчетнаяСистема ДОЛЖНА открыть форму выбора элемента справочника с возможностью быстрого поиска по наименованию
10. КОГДА пользователь начинает вводить текст в поле справочника, УчетнаяСистема ДОЛЖНА предоставить автодополнение с выпадающим списком подходящих элементов справочника (минимум 3 символа для активации)
11. КОГДА пользователь нажимает Ctrl+Enter в форме документа или элемента справочника, УчетнаяСистема ДОЛЖНА нажать кнопку по умолчанию (обычно "Сохранить и закрыть" или "ОК")
12. КОГДА пользователь работает с формой списка, УчетнаяСистема ДОЛЖНА сохранять настройки отображения колонок (ширина, порядок, видимость) для каждого пользователя
13. КОГДА пользователь дважды щелкает на разделителе колонок в форме списка, УчетнаяСистема ДОЛЖНА автоматически подобрать ширину колонки по содержимому
14. КОГДА пользователь нажимает Ctrl+F в форме списка, УчетнаяСистема ДОЛЖНА активировать строку быстрого поиска с фильтрацией списка по мере ввода текста
15. КОГДА пользователь закрывает форму документа с несохраненными изменениями, УчетнаяСистема ДОЛЖНА показать диалог подтверждения с вариантами: "Сохранить", "Не сохранять", "Отмена"
16. КОГДА пользователь открывает форму документа или элемента справочника, УчетнаяСистема ДОЛЖНА установить кнопку по умолчанию (обычно "Сохранить и закрыть" или "ОК"), которая активируется по нажатию Ctrl+Enter
17. КОГДА пользователь нажимает кнопку "Сохранить и закрыть" в форме документа Смета или Ежедневный_Отчет, УчетнаяСистема ДОЛЖНА автоматически провести документ перед закрытием формы
18. КОГДА пользователь работает с открытым документом Смета или Ежедневный_Отчет, УчетнаяСистема ДОЛЖНА предоставить кнопку "Импорт из Excel" в панели инструментов формы документа для загрузки данных в табличную часть открытого документа
19. КОГДА пользователь нажимает Ctrl+V в Табличная_Часть документа, УчетнаяСистема ДОЛЖНА проверить содержимое буфера обмена и, если там находятся ячейки таблицы Excel с типами данных, совпадающими с колонками документа, вставить данные в табличную часть начиная с текущей позиции курсора
20. КОГДА пользователь выбирает пункт меню "Операции" → "Удаление помеченных объектов" в главном окне, УчетнаяСистема ДОЛЖНА открыть форму со списком всех объектов, помеченных на удаление
21. КОГДА пользователь открывает форму удаления помеченных объектов, УчетнаяСистема ДОЛЖНА провести контроль зависимых объектов и отобразить для каждого помеченного объекта список объектов, которые на него ссылаются
22. КОГДА пользователь видит зависимые объекты в форме удаления помеченных объектов, УчетнаяСистема ДОЛЖНА предоставить возможность пометить зависимые объекты на удаление прямо из этой формы
23. КОГДА пользователь нажимает кнопку "Удалить" в форме удаления помеченных объектов, УчетнаяСистема ДОЛЖНА удалить все помеченные объекты, не имеющие непомеченных зависимых объектов, и показать отчет об удалении
