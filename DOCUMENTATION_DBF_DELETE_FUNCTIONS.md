"""–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è - DBF Importer: Delete Functions
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π —É–¥–∞–ª–µ–Ω–∏—è –≤ DBF Importer
"""

## üéØ –ó–∞–¥–∞—á–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### ‚úÖ –ó–∞–¥–∞—á–∞ 1: –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É 'delete all docs'
**–°—Ç–∞—Ç—É—Å**: –ó–ê–í–ï–†–®–ï–ù–û ‚úÖ

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
- **–§–∞–π–ª**: `dbf_importer/ui/main_window.py`
- **–ú–µ—Ç–æ–¥**: `delete_all_documents()` (—Å—Ç—Ä–æ–∫–∏ 449-521)
- **UI**: –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—Å—Ç—Ä–æ–∫–∞ 201)

#### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
```python
# –¢–∞–±–ª–∏—Ü—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è (–≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ):
doc_tables = [
    "estimate_lines",           # –°–Ω–∞—á–∞–ª–∞ –¥–æ—á–µ—Ä–Ω–∏–µ –∑–∞–ø–∏—Å–∏
    "daily_report_lines",
    "daily_report_executors", 
    "timesheet_lines",
    "work_execution_register",
    "estimates",               # –ó–∞—Ç–µ–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –∑–∞–ø–∏—Å–∏
    "daily_reports",
    "timesheets"
]
```

#### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- ‚úÖ **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: –î–µ—Ç–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ–±–æ –≤—Å–µ—Ö —É–¥–∞–ª—è–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫**: –°–Ω–∞—á–∞–ª–∞ –¥–æ—á–µ—Ä–Ω–∏–µ –∑–∞–ø–∏—Å–∏, –∑–∞—Ç–µ–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ (foreign keys)
- ‚úÖ **–ü–æ–¥—Å—á–µ—Ç –∑–∞–ø–∏—Å–µ–π**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã
- ‚úÖ **–ü—Ä–æ–≥—Ä–µ—Å—Å**: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ "–¢–∞–±–ª–∏—Ü–∞ X/Y: –∏–º—è_—Ç–∞–±–ª–∏—Ü—ã"
- ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: Rollback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö, –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ **–ù–µ —Ç—Ä–µ–±—É–µ—Ç DBF –ø—É—Ç–∏**: –ú–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É 'delete references'
**–°—Ç–∞—Ç—É—Å**: –ü–†–û–í–ï–†–ï–ù–û ‚úÖ

#### –ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏–∏:
- **–§–∞–π–ª**: `dbf_importer/ui/main_window.py`
- **–ú–µ—Ç–æ–¥**: `clear_references()` (—Å—Ç—Ä–æ–∫–∏ 407-447)
- **–¢–∞–±–ª–∏—Ü—ã**: `["units", "materials", "works"]`

#### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏:
- ‚úÖ **–†–∞–±–æ—á–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**: –§—É–Ω–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–∂–∏–¥–∞–µ—Ç—Å—è
- ‚úÖ **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: –ò–º–µ–µ—Ç –¥–∏–∞–ª–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç transaction + rollback
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –ª–æ–≥
- ‚ö†Ô∏è **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫**: –¢—Ä–µ–±—É–µ—Ç –≤—ã–±–æ—Ä–∞ DBF –ø—É—Ç–∏ (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—É–¥–æ–±–Ω–æ)

#### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π:

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | clear_references | delete_all_documents |
|----------------|-------------------|---------------------|
| **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ** | –û—á–∏—Å—Ç–∫–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤ | –£–¥–∞–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ |
| **–¢–∞–±–ª–∏—Ü—ã** | units, materials, works | estimates, reports, timesheets |
| **–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –ø—É—Ç–∏** | ‚ùå –î–∞ | ‚úÖ –ù–µ—Ç |
| **–ü–æ–¥—Å—á–µ—Ç –∑–∞–ø–∏—Å–µ–π** | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ |
| **–ü—Ä–æ–≥—Ä–µ—Å—Å** | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ |
| **–ü–æ—Ä—è–¥–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è** | –ù–µ –≤–∞–∂–Ω–æ | ‚úÖ –í–∞–∂–µ–Ω |

---

## üìã –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

### 1. `dbf_importer/ui/main_window.py`
```python
# –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã
from sqlalchemy import text

# –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ (—Å—Ç—Ä–æ–∫–∞ ~201)
self.delete_all_docs_button = QPushButton("–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã")
self.delete_all_docs_button.clicked.connect(self.delete_all_documents)

# –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ (—Å—Ç—Ä–æ–∫–∏ 449-521)
def delete_all_documents(self):
    """–£–¥–∞–ª—è–µ—Ç –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–∑ —Å–∏—Å—Ç–µ–º—ã"""
    # –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º

# –û–±–Ω–æ–≤–ª–µ–Ω set_ui_enabled (—Å—Ç—Ä–æ–∫–∞ 522)
self.delete_all_docs_button.setEnabled(enabled)
```

### 2. `test_delete_functions.py`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞–Ω–∞–ª–∏–∑ —Ñ—É–Ω–∫—Ü–∏–π —É–¥–∞–ª–µ–Ω–∏—è
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: `python test_delete_functions.py`

---

## üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### –î–ª—è `clear_references`:
1. **–£–±—Ä–∞—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ DBF –ø—É—Ç–∏** –¥–ª—è –±–æ–ª—å—à–µ–π —É–¥–æ–±–Ω–æ—Å—Ç–∏
2. **–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Å—á–µ—Ç –∑–∞–ø–∏—Å–µ–π** –∫–∞–∫ –≤ `delete_all_documents`
3. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä** –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö

### –û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
1. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü—Ä–µ–¥–ª–∞–≥–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º
2. **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—Å–∫–∏—Ö –ø—Ä–∞–≤
3. **Batch –æ–ø–µ—Ä–∞—Ü–∏–∏**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü
4. **Audit –ª–æ–≥**: –ó–∞–ø–∏—Å—å –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –∞—É–¥–∏—Ç–∞

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

‚úÖ **–û–±–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é**:
- –ö–Ω–æ–ø–∫–∞ "–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã" –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è "–û—á–∏—Å—Ç–∏—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏" –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –û–±–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–º–µ—é—Ç –ø–æ–ª–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- UI –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∫–Ω–æ–ø–æ–∫

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ